<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title type="text" xml:lang="en">Damian Zaremba's Blog</title>
    <link type="application/atom+xml" href="http://damianzaremba.co.uk/feed/" rel="self"/>
    <link type="text" href="http://damianzaremba.co.uk" rel="alternate"/>
    <updated>2012-08-20T00:11:05+01:00</updated>
    <id>http://damianzaremba.co.uk/</id>
    <author>
        <name>Damian Zaremba</name>
    </author>
    <rights>Copyright 2009-2012 Damian Zaremba</rights>
    
    <entry>
        <title>RADIUS authentication on a HP ProCurve switch</title>
        <link href="http://damianzaremba.co.uk/2012/04/radius-authentication-on-a-hp-procurve-switch//"/>
        <updated>2012-04-01T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2012/04/radius-authentication-on-a-hp-procurve-switch//</id>
        <summary type="html"><![CDATA[<p>To configure a HP ProCurve switch for RADIUS authentication you need to use radius-server with the following syntax.</p>

<div class="highlight"><pre><code class="text">radius-server host serverIp key &quot;SecretKeyHere&quot;
</code></pre>
</div>


<p>Once this is setup you need to configure the switch to authenticate against the radius server.</p>

<div class="highlight"><pre><code class="text">aaa authentication login privilege-mode 
aaa authentication console login radius local 
aaa authentication console enable radius local 
aaa authentication telnet login radius local 
aaa authentication telnet enable radius local 
aaa authentication web login radius local 
aaa authentication ssh login radius local 
aaa authentication ssh enable radius local 
</code></pre>
</div>


<p>We include the local option so that in the event of the RADIUS server being down we can still authenticate.</p>
]]></summary>
    </entry>
    
    <entry>
        <title>RADIUS authentication on a HP GbE2c L2/L3 Blade Switch</title>
        <link href="http://damianzaremba.co.uk/2012/04/radius-authentication-on-a-hp-gbe2c-l2-l3-blade-switch//"/>
        <updated>2012-04-01T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2012/04/radius-authentication-on-a-hp-gbe2c-l2-l3-blade-switch//</id>
        <summary type="html"><![CDATA[<p>To configure a HP GbE2c L2/L3 Ethernet Blade Switch for RADIUS authentication you need to use radius-server with the following syntax.</p>

<div class="highlight"><pre><code class="text">radius-server primary-host serverIp
radius-server primary-host serverIp key &quot;SecretKeyHere&quot;
radius-server port 1812
radius-server timeout 10
radius-server enable
no radius-server telnet-backdoor
radius-server secure-backdoor
</code></pre>
</div>


<p>The first and second lines setup the server/key to authenticate against.</p>

<p>The third/forth defines the port/timeout for the server we configured in the first lines.</p>

<p>The last 3 then enable the server and enable a backdoor so we can authenticate against the switch if the RADIUS server is down.</p>
]]></summary>
    </entry>
    
    <entry>
        <title>SNTP on a HP ProCurve switch</title>
        <link href="http://damianzaremba.co.uk/2012/03/sntp-on-a-hp-procurve-switch//"/>
        <updated>2012-03-18T00:00:00+00:00</updated>
        <id>http://damianzaremba.co.uk/2012/03/sntp-on-a-hp-procurve-switch//</id>
        <summary type="html"><![CDATA[<p>Configuring NTP for switches is a rather simple process, however the syntax varies depending on the switch OS.</p>

<p>Most switches use SNTP rather than NTP, SNTP is basically NTP but lacks some of the more advanced internal algorithms and is slightly less accurate.</p>

<p>To configure a ProCurve you need to use SNTP with the following syntax.</p>

<div class="highlight"><pre><code class="text">sntp server &lt;ip&gt;
sntp unicast
timesync sntp
</code></pre>
</div>


<p>The first line defines what IP to sync with, the second tells the switch to use unicast UDP rather than TCP and the third tells the switch to sync it's time with the SNTP server.</p>

<p>This needs to be done in configure mode which can be got into via enable mode.</p>

<div class="highlight"><pre><code class="text">enable
configure
</code></pre>
</div>


<p>Once the switch is syncing with the SNTP server you can check the time is correct with</p>

<div class="highlight"><pre><code class="text">show time
</code></pre>
</div>


<p>Lastly just save the changes then logout</p>

<div class="highlight"><pre><code class="text">write mem
logout
</code></pre>
</div>


<p>A full example of this is below:</p>

<div class="highlight"><pre><code class="text">Switch&gt; en
Switch# conf
Switch(config)# sntp server 79.142.192.4
Switch(config)# sntp unicast
Switch(config)# timesync sntp
Switch(config)# exit
Switch# write mem
Switch# logout
</code></pre>
</div>


<p>Your switches should now keep their time in sync :)</p>
]]></summary>
    </entry>
    
    <entry>
        <title>NTP on a HP GbE2c L2/L3 Blade Switch</title>
        <link href="http://damianzaremba.co.uk/2012/03/sntp-on-a-hp-gbe2c-l2-l3-blade-switch//"/>
        <updated>2012-03-18T00:00:00+00:00</updated>
        <id>http://damianzaremba.co.uk/2012/03/sntp-on-a-hp-gbe2c-l2-l3-blade-switch//</id>
        <summary type="html"><![CDATA[<p>To configure a HP GbE2c L2/L3 Ethernet Blade Switch for HP c-Class BladeSystem, you need to use NTP with the following syntax.</p>

<div class="highlight"><pre><code class="text">ntp enable 
ntp timezone 0
ntp primary-server &lt;ip&gt;
ntp secondary-server &lt;ip&gt;
</code></pre>
</div>


<p>The first line enables NTP, the second tells the switch to use GMT+0 and the third/forth tells the switch which servers to sync with.</p>

<p>This needs to be done in configure mode which can be got into via enable mode.</p>

<div class="highlight"><pre><code class="text">enable
configure
</code></pre>
</div>


<p>Now ensure the switch timezone is correct, the command for this is slightly obnoxious. Below is an example of setting it to GB:</p>

<div class="highlight"><pre><code class="text">Switch(config)# system timezone 
Please identify a location so that time zone rules can be set correctly.
Please select a continent or ocean.
 1) Africa
 2) Americas
 3) Antarctica
 4) Arctic Ocean
 5) Asia
 6) Atlantic Ocean
 7) Australia
 8) Europe
 9) Indian Ocean
10) Pacific Ocean
11) None - disable timezone setting
#? 8
Please select a country.
 1) Albania               16) Gibraltar     31) Poland
 2) Andorra               17) Greece        32) Portugal
 3) Austria               18) Hungary       33) Romania
 4) Belarus               19) Ireland       34) Russia
 5) Belgium               20) Italy         35) San Marino
 6) Bosnia &amp; Herzegovina  21) Latvia        36) Slovakia
 7) Britain (UK)          22) Liechtenstein 37) Slovenia
 8) Bulgaria              23) Lithuania     38) Spain
 9) Croatia               24) Luxembourg    39) Sweden
10) Czech Republic        25) Macedonia     40) Switzerland
11) Denmark               26) Malta         41) Turkey
12) Estonia               27) Moldova       42) Ukraine
13) Finland               28) Monaco        43) Vatican City
14) France                29) Netherlands   44) Yugoslavia
15) Germany               30) Norway
#? 7
Please select one of the following time zone regions.
1) Great Britain
2) Northern Ireland
#? 1 
System timezone set to : Europe/Britain/GB
</code></pre>
</div>


<p>Lastly just save the changes then logout</p>

<div class="highlight"><pre><code class="text">copy run start
logout
</code></pre>
</div>


<p>A full example of this is below:</p>

<div class="highlight"><pre><code class="text">Switch&gt; en
Switch# conf t
Switch(config)# ntp enable
Switch(config)# ntp timezone 0
Switch(config)# ntp primary-server 79.142.192.4
Switch(config)# ntp secondary-server 217.147.208.1
Switch(config)# exit
Switch# copy run start
Switch# logout
</code></pre>
</div>


<p>Your switches should now keep their time in sync :)</p>
]]></summary>
    </entry>
    
    <entry>
        <title>Restricting access to EdgeCast nodes</title>
        <link href="http://damianzaremba.co.uk/2011/11/restricting-access-to-edgecast-nodes//"/>
        <updated>2011-11-02T00:00:00+00:00</updated>
        <id>http://damianzaremba.co.uk/2011/11/restricting-access-to-edgecast-nodes//</id>
        <summary type="html"><![CDATA[<p>Today one of our clients published a mix track that was around 140mb, hosted on their account. This was no problem until he started to get hundreds of people downloading the mix which resulted in silly amounts of bandwidth being used.</p>

<p>We quickly had to move him on to the CDN to ensure the traffic impact wasn't affecting performance for him or others as well as reduce his bandwidth charges substantially.</p>

<p>Once the CDN was all set up and the content pushed out onto the nodes we started to send traffic over.</p>

<p>Due to the impact of social media and people linking directly to the content we had to devise a plan to enable access to the content for the CDN but redirect anyone linking directly to the CDNified subdomain.</p>

<p>In comes mod_rewrite. Now it appears EdgeCast don't publish their IP ranges in any format that helps my sanity, they are in fact published in a html table. To find them, login to my.edgecast.com, browse to HTTP Large, click on Customer Origin and scroll down to the bottom.</p>

<p>Linux to the rescue! First we just copy the list into a file:</p>

<div class="highlight"><pre><code class="bash"><span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span>cat &gt; edgecast_ranges
Asia Hong Kong 117.18.234.0 - 117.18.234.255
110.232.176.0 - 110.232.176.255
Asia Singapore 117.18.236.0 - 117.18.236.255
46.22.71.0 - 46.22.71.255
Asia Tokyo 117.18.233.0 - 117.18.233.255
110.232.177.0 - 110.232.177.255
Australia Sydney 117.18.235.0 - 117.18.235.255
110.232.179.0 - 110.232.179.255
Europe Amsterdam 93.184.208.0 - 93.184.208.255
93.184.209.0 - 93.184.209.255
93.184.217.0 - 93.184.217.255
46.22.70.0 - 46.22.70.255
46.22.72.0 - 46.22.73.255
Europe Frankfurt 72.21.89.0 - 72.21.89.255
93.184.212.0 - 93.184.212.255
93.184.213.0 - 93.184.213.255
Europe London 72.21.90.0 - 72.21.90.255
93.184.210.0 - 93.184.210.255
93.184.211.0 - 93.184.211.255
46.22.74.0 - 46.22.75.255
Europe Madrid 46.22.66.0 - 46.22.67.255
Europe Paris 93.184.214.0 - 93.184.214.255
North America Ashburn 72.21.83.0 - 72.21.83.255
68.232.36.0 - 68.232.36.255
North America Atlanta 72.21.88.0 - 72.21.88.255
72.21.93.0 - 72.21.93.255
North America Chicago 72.21.87.0 - 72.21.87.255
68.232.38.0 - 68.232.38.255
North America Dallas 72.21.86.0 - 72.21.86.255
68.232.39.0 - 68.232.39.255
North America Los Angeles 72.21.84.0 - 72.21.84.255
68.232.40.0 - 68.232.40.255
72.21.94.0 - 72.21.94.255
93.184.218.0 - 93.184.218.255
46.22.69.0 - 46.22.69.255
North America Miami 46.22.64.0 - 46.22.65.255
North America New York 72.21.95.0 - 72.21.95.255
68.232.37.0 - 68.232.37.255
North America San Jose
North America San Jose 72.21.82.0 - 72.21.82.255
68.232.41.0 - 68.232.41.255
North America Seattle 72.21.85.0 - 72.21.85.255
Other N/A 72.21.80.0 - 72.21.80.255
72.21.81.0 - 72.21.81.255
72.21.91.0 - 72.21.91.255
72.21.92.0 - 72.21.92.255
117.18.232.0 - 117.18.232.255
93.184.221.0 - 93.184.221.255
93.184.220.0 - 93.184.220.255
93.184.219.0 - 93.184.219.255
117.18.237.0 - 117.18.237.255
93.184.215.0 - 93.184.215.255
93.184.216.0 - 93.184.216.255
68.232.32.0 - 68.232.32.255
68.232.33.0 - 68.232.33.255
68.232.34.0 - 68.232.34.255
68.232.35.0 - 68.232.35.255
68.232.42.0 - 68.232.42.255
68.232.43.0 - 68.232.43.255
68.232.44.0 - 68.232.44.255
68.232.45.0 - 68.232.45.255
68.232.46.0 - 68.232.46.255
68.232.47.0 - 68.232.47.255
93.184.222.0 - 93.184.222.255
93.184.223.0 - 93.184.223.255
110.232.178.0 - 110.232.178.255
117.18.237.0 - 117.18.237.255
117.18.238.0 - 117.18.238.255
117.18.239.0 - 117.18.239.255
</code></pre>
</div>


<p>Next we need to clear out all the names etc that are randomly dumped in the file:</p>

<div class="highlight"><pre><code class="bash"><span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span>sed -i <span class="s1">&#39;s/^.*\s.*\s//g&#39;</span> edgecast_ranges <span class="c"># Get rid of place names</span>
<span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span>sed -i <span class="s1">&#39;/^\s*$/d&#39;</span> edgecast_ranges <span class="c"># Get rid of blank lines</span>
</code></pre>
</div>


<p>Now let's actually turn these IP ranges into something Apache can understand (they are all /24's so we can cheat):</p>

<div class="highlight"><pre><code class="bash"><span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span>sed -i <span class="s1">&#39;s/^/RewriteCond %{REMOTE_ADDR} !^/g&#39;</span> edgecast_ranges <span class="c"># Add the rewrite cond</span>
<span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span>sed -i <span class="s1">&#39;s/\.255$/.*$/g&#39;</span> edgecast_ranges <span class="c"># Add the wildcard</span>
</code></pre>
</div>


<p>Now let's create the actual htaccess file:</p>

<div class="highlight"><pre><code class="bash"><span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;RewriteEngine On&#39;</span> &gt;&gt; .htaccess
<span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span>cat edgecast_ranges &gt;&gt; .htaccess
<span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;RewriteRule ^downloads/(.*)$ http://media.example.com/$1 [R,L]&#39;</span> &gt;&gt; .htaccess
</code></pre>
</div>


<p>You should end up with something looking like this:</p>

<div class="highlight"><pre><code class="bash">RewriteEngine On
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^117.18.234.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^110.232.176.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^117.18.236.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^46.22.71.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^117.18.233.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^110.232.177.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^117.18.235.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^110.232.179.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.208.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.209.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.217.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^46.22.70.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^46.22.72.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.89.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.212.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.213.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.90.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.210.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.211.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^46.22.74.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^46.22.66.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.214.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.83.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.36.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.88.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.93.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.87.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.38.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.86.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.39.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.84.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.40.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.94.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.218.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^46.22.69.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^46.22.64.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.95.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.37.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.82.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.41.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.85.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.80.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.81.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.91.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^72.21.92.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^117.18.232.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.221.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.220.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.219.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^117.18.237.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.215.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.216.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.32.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.33.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.34.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.35.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.42.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.43.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.44.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.45.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.46.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^68.232.47.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.222.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^93.184.223.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^110.232.178.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^117.18.237.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^117.18.238.*<span class="err">$</span>
RewriteCond %<span class="o">{</span>REMOTE_ADDR<span class="o">}</span> !^117.18.239.*<span class="err">$</span>
RewriteRule ^downloads/<span class="o">(</span>.*<span class="o">)</span><span class="nv">$ </span>http://media.example.com/<span class="nv">$1</span> <span class="o">[</span>R,L<span class="o">]</span>
</code></pre>
</div>


<p>If you browse to http://example.com/downloads/ you should be redirected to http://media.example.com/ unless you are coming from an Edgecast IP range.</p>

<p>Now you can go back to reading slashdot ;)</p>
]]></summary>
    </entry>
    
    <entry>
        <title>Changing WordPress tag to category?</title>
        <link href="http://damianzaremba.co.uk/2011/08/changing-wordpress-tag-to-category//"/>
        <updated>2011-08-25T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/changing-wordpress-tag-to-category//</id>
        <summary type="html"><![CDATA[<p>While there appears to be plugins for converting categories to tags, I can't for the life of me find one to convert tags to categories.</p>

<p>After a quick poke around in the database it seem quite simple to convert between the two.
Note: This /seems/ to work however it might kick you in the face and break stuff.</p>

<p>First find out your "term" id (category or tag):</p>

<div class="highlight"><pre><code class="bash">mysql&gt; SELECT * FROM <span class="sb">`</span>terms<span class="sb">`</span> WHERE <span class="sb">`</span>slug<span class="sb">`</span> <span class="o">=</span> <span class="s1">&#39;snippets&#39;</span>;
+---------+----------+----------+------------+
| term_id | name | slug | term_group |
+---------+----------+----------+------------+
| 171 | Snippets | snippets | 0 |
+---------+----------+----------+------------+
1 row in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</code></pre>
</div>


<p>Now look in the taxonomy table and find out its details:</p>

<div class="highlight"><pre><code class="bash">mysql&gt; SELECT * FROM <span class="sb">`</span>term_taxonomy<span class="sb">`</span> WHERE <span class="sb">`</span>term_id<span class="sb">`</span> <span class="o">=</span> 171;
+------------------+---------+----------+-------------+--------+-------+
| term_taxonomy_id | term_id | taxonomy | description | parent | count |
+------------------+---------+----------+-------------+--------+-------+
| 174 | 171 | post_tag | | 0 | 17 |
+------------------+---------+----------+-------------+--------+-------+
1 row in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</code></pre>
</div>


<p>As you can see it is currently a "post_tag".</p>

<p>To change it to a category change the "taxonomy" field to "category":</p>

<div class="highlight"><pre><code class="bash">mysql&gt; UPDATE <span class="sb">`</span>term_taxonomy<span class="sb">`</span> SET <span class="sb">`</span>taxonomy<span class="sb">`</span> <span class="o">=</span> <span class="s1">&#39;category&#39;</span> WHERE <span class="sb">`</span>term_id<span class="sb">`</span> <span class="o">=</span> 171;
Query OK, 1 row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
Rows matched: 1 Changed: 1 Warnings: 0
</code></pre>
</div>


<p>Or to change it from a category to a tag then change the "taxonomy" field to "post_tag":</p>

<div class="highlight"><pre><code class="bash">mysql&gt; UPDATE <span class="sb">`</span>term_taxonomy<span class="sb">`</span> SET <span class="sb">`</span>taxonomy<span class="sb">`</span> <span class="o">=</span> <span class="s1">&#39;post_tag&#39;</span> WHERE <span class="sb">`</span>term_id<span class="sb">`</span> <span class="o">=</span> 171;
Query OK, 1 row affected <span class="o">(</span>0.02 sec<span class="o">)</span>
Rows matched: 1 Changed: 1 Warnings: 0
</code></pre>
</div>



]]></summary>
    </entry>
    
    <entry>
        <title>Changing the MySQL client prompt</title>
        <link href="http://damianzaremba.co.uk/2011/08/changing-the-mysql-client-prompt//"/>
        <updated>2011-08-25T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/changing-the-mysql-client-prompt//</id>
        <summary type="html"><![CDATA[<p>It is quite easy to get lost in MySQL when working between a lot of databases.</p>

<p>While you can find out which database you are in, it soon becomes quite irritating having to type</p>

<div class="highlight"><pre><code class="bash">mysql&gt; <span class="k">select </span>database<span class="o">()</span>;

+------------------+
| database<span class="o">()</span> |
+------------------+
| test_database |
+------------------+
1 row in <span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>
</code></pre>
</div>


<p>The simplest way to solve this and make life easier, is to change the prompt to include the info!
Simple edit the [mysql] section of your my.cnf file and add the prompt option:</p>

<div class="highlight"><pre><code class="bash"><span class="o">[</span>client<span class="o">]</span>
<span class="nv">host</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
<span class="nv">user</span> <span class="o">=</span> <span class="s2">&quot;mehuser&quot;</span>
<span class="nv">pass</span> <span class="o">=</span> <span class="s2">&quot;someubersecurepassword&quot;</span>
<span class="nv">prompt</span><span class="o">=</span>mysql <span class="o">[</span><span class="se">\\</span>u@<span class="se">\\</span>h - <span class="se">\\</span>d<span class="o">]</span>&gt;
</code></pre>
</div>


<p>Now when you use the client the prompt will show mysql [user@host - database]>:</p>

<div class="highlight"><pre><code class="bash">mysql <span class="o">[</span>test1@localhost - test_database<span class="o">]</span>&gt;
</code></pre>
</div>


<p>No more getting confused! If you don't have access to /etc/my.cnf then use ~/.my.cnf, I usually stick the connection details in there as well - then you can have huge passwords and never have to type/remember them:</p>

<div class="highlight"><pre><code class="bash"><span class="o">[</span>client<span class="o">]</span>
<span class="nv">host</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
<span class="nv">user</span> <span class="o">=</span> <span class="s2">&quot;mehuser&quot;</span>
<span class="nv">pass</span> <span class="o">=</span> <span class="s2">&quot;someubersecurepassword&quot;</span>
<span class="nv">prompt</span><span class="o">=</span>mysql <span class="o">[</span><span class="se">\\</span>u@<span class="se">\\</span>h - <span class="se">\\</span>d<span class="o">]</span>&gt;
</code></pre>
</div>



]]></summary>
    </entry>
    
    <entry>
        <title>Useful cPanel paths</title>
        <link href="http://damianzaremba.co.uk/2011/08/useful-cpanel-paths//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/useful-cpanel-paths//</id>
        <summary type="html"><![CDATA[<p>Some common and useful paths for cPanel are as below - please note that these may change at any time.</p>

<table>
    <thead>
        <tr>
            <th>Location</th>
            <th>Contents</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>/etc/ips</td>
            <td>IP Addresses</td>
        </tr>
        <tr>
            <td>/etc/reservedips</td>
            <td>Reserved IP addresses</td>
        </tr>
        <tr>
            <td>/etc/reservedipreasons</td>
            <td>Reserved IP address reasons</td>
        </tr>
        <tr>
            <td>~/.accesshash</td>
            <td>WHM API key</td>
        </tr>
        <tr>
            <td>/etc/cpupdate.conf</td>
            <td>cPanel update configuration</td>
        </tr>
        <tr>
            <td>/etc/wwwacct.conf</td>
            <td>Basic cPanel config</td>
        </tr>
        <tr>
            <td>/var/cpanel/maxemailsperhour</td>
            <td>System wide max emails per hour setting</td>
        </tr>
        <tr>
            <td>/var/cpanel/packages</td>
            <td>cPanel packages</td>
        </tr>
        <tr>
            <td>/var/cpanel/users</td>
            <td>User data</td>
        </tr>
        <tr>
            <td>/var/cpanel/templates/apache2</td>
            <td>Apache vhost templates</td>
        </tr>
        <tr>
            <td>/usr/local/apache/conf/userdata/std/2/$user/$domain/configuration.conf</td>
            <td>Apache vhost config customizations for $user's $domain (not SSL)</td>
        </tr>
        <tr>
            <td>/usr/local/apache/conf/userdata/ssl/2/$user/$domain/configuration.conf</td>
            <td>Apache vhost config customizations for $user's $domain (SSL)</td>
        </tr>
        <tr>
            <td>/etc/userdomains</td>
            <td>Users domains</td>
        </tr>
        <tr>
            <td>/usr/local/cpanel/version</td>
            <td>cPanel version</td>
        </tr>
        <tr>
            <td>/var/cpanel/resellers</td>
            <td>Resellers</td>
        </tr>
        <tr>
            <td>/scripts</td>
            <td>Loads of useful cPanel related scripts</td>
        </tr>
        <tr>
            <td>/usr/local/cpanel/bin</td>
            <td>Loads of useful cPanel scripts</td>
        </tr>
    </tbody>
</table>



]]></summary>
    </entry>
    
    <entry>
        <title>Upgrade EOL Clamav</title>
        <link href="http://damianzaremba.co.uk/2011/08/upgrade-eol-clamav//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/upgrade-eol-clamav//</id>
        <summary type="html"><![CDATA[

<div class="highlight"><pre><code class="text">ClamAV have EOL&#39;d all their versions prior to 0.95 - if you see an error like the following then ClamAV needs an update:
 LibClamAV Warning: ***********************************************************
 LibClamAV Warning: *** This version of the ClamAV engine is outdated. ***
 LibClamAV Warning: *** DON&#39;T PANIC! Read http://www.clamav.net/support/faq ***
 LibClamAV Warning: ***********************************************************
 LibClamAV Error: cli_hex2str(): Malformed hexstring: This ClamAV version has reached End of Life! Please upgrade to version 0.95 or later. For more information see www.clamav.net/eol-clamav-094 and www.clamav.net/download (length: 169)
 LibClamAV Error: Problem parsing database at line 742
 LibClamAV Error: Can&#39;t load daily.ndb: Malformed database
 LibClamAV Error: cli_tgzload: Can&#39;t load daily.ndb
 LibClamAV Error: Can&#39;t load /var/lib/clamav/daily.cld: Malformed database
 ERROR: Malformed database
</code></pre>
</div>


<p>To upgrade ClamAV on a RHEL based system perform the following:</p>

<ol>
<li>wget http://pkgs.repoforge.org/clamav/clamav-0.96.1-1.el5.src.rpm</li>
<li>yum install srpm unzip</li>
<li>CFLAGS="-O0" ./configure --disable-zlib-vcheck</li>
<li>make &amp;&amp; make install</li>
<li>Update /usr/local/etc/clamd.conf (notably removing the "Example" line and un-commenting the TCP socket line).</li>
</ol>


<p>ClamAV should now work once again.</p>
]]></summary>
    </entry>
    
    <entry>
        <title>Spoon!</title>
        <link href="http://damianzaremba.co.uk/2011/08/spoon//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/spoon//</id>
        <summary type="html"><![CDATA[<p>It still needs some work to smooth out the handle and round the top off as well as sanding the dip out but I've made a pretty decent start on a spoon.</p>

<p>This started out as part of a tree trunk which got removed and split with an axe, from there all the work has been done with 3 knives:</p>

<ul>
<li>Spoon knife - for rounding the handle and scraping out the dip</li>
<li>9" knife - for taking off the thick outer and bark</li>
<li>Gerber STL 2.5 knife - for taking tiny slivers off the handle and smoothing out some of the head</li>
</ul>


<p>Here are some "early" (4/5 days of on and off work) pictures...</p>

<p><img src="/2011/08/spoon/IMG_0020.jpg" alt="" /> <img src="/2011/08/spoon/IMG_0021.jpg" alt="" /> <img src="/2011/08/spoon/IMG_0022.jpg" alt="" />
<img src="/2011/08/spoon/IMG_0023.jpg" alt="" /> <img src="/2011/08/spoon/IMG_0024.jpg" alt="" /> <img src="/2011/08/spoon/IMG_0027.jpg" alt="" />
<img src="/2011/08/spoon/IMG_0028.jpg" alt="" /></p>
]]></summary>
    </entry>
    
    <entry>
        <title>SMTP Authentication in Postfix using local system accounts</title>
        <link href="http://damianzaremba.co.uk/2011/08/smtp-authentication-in-postfix-using-local-system-accounts//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/smtp-authentication-in-postfix-using-local-system-accounts//</id>
        <summary type="html"><![CDATA[<p>In /etc/postfix/main.cf ensure the following values are set</p>

<div class="highlight"><pre><code class="text">message_size_limit = 204800000
smtpd_recipient_restrictions = permit_sasl_authenticated permit_inet_interfaces reject_unauth_destination, permit
smtpd_sasl_auth_enable = yes
broken_sasl_auth_clients = yes
</code></pre>
</div>


<p>This will ensure postfix denies any un-authenticated attempts to send mail and enabled sasl authentication.</p>

<p>Next we just need to make sure sasl/postfix are setup to run:</p>

<div class="highlight"><pre><code class="bash">chkconfig saslauthd on
/etc/init.d/saslauthd restart
chkconfig postfix on
/etc/init.d/postfix restart
</code></pre>
</div>


<p>Once this is done all we need to do is add our users and they can send mail:</p>

<div class="highlight"><pre><code class="bash">adduser -s /sbin/nologin -M user1
passwd user1

adduser -s /sbin/nologin -M user2
passwd user2
</code></pre>
</div>



]]></summary>
    </entry>
    
    <entry>
        <title>Recovering deleted files from the handlers in /proc/</title>
        <link href="http://damianzaremba.co.uk/2011/08/recovering-deleted-files-from-the-handlers-in-proc//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/recovering-deleted-files-from-the-handlers-in-proc//</id>
        <summary type="html"><![CDATA[<p>On compromised servers it is very common for the exploit to delete its self/logs to try and hide its presence.</p>

<p>Even though the executable may be removed from the filesystem as the process is forked from apache the parent process will still have file handlers open.</p>

<p>This will allow you to recover log files/executables as long as you do not kill the process.</p>

<p>To recover the files use the following steps:</p>

<ol>
<li>Find the PID of the process with the open file handlers (use lsof)</li>
<li>cd /proc//fd where  is what you found using lsof above</li>
<li>ls -lra and you should see a load of broken symlinks (red)</li>
<li>Copy the file using cp into another directory</li>
</ol>

]]></summary>
    </entry>
    
    <entry>
        <title>Quick script to get public IPs on a NAT'd server</title>
        <link href="http://damianzaremba.co.uk/2011/08/quick-script-to-get-public-ips-on-a-natd-server//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/quick-script-to-get-public-ips-on-a-natd-server//</id>
        <summary type="html"><![CDATA[<p>A quick one liner to get the public equivalent of internal IPs on a box behind NAT:</p>

<div class="highlight"><pre><code class="bash"><span class="k">for </span>int in <span class="k">$(</span>ifconfig | grep <span class="s2">&quot;Link encap:&quot;</span> | awk <span class="s1">&#39;{print $1}&#39;</span> | grep -v <span class="s1">&#39;lo&#39;</span><span class="k">)</span>; <span class="k">do </span><span class="nb">echo</span> <span class="s2">&quot;$int: $(ifconfig $int | grep &quot;</span>inet addr:<span class="s2">&quot; | awk &#39;{print $2}&#39; | cut -d: -f2) =&gt; $(curl -s --interface $int ipv4.canhazip.info)&quot;</span>; <span class="k">done</span>
</code></pre>
</div>


<p>I've restricted this to IPv4 only - NATing IPv6 is just silly but if you really want then it is on your head.</p>

<p>Example usage is as follows:</p>

<div class="highlight"><pre><code class="bash"><span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span><span class="k">for </span>int in <span class="k">$(</span>ifconfig | grep <span class="s2">&quot;Link encap:&quot;</span> | awk <span class="s1">&#39;{print $1}&#39;</span> | grep -v <span class="s1">&#39;lo&#39;</span><span class="k">)</span>; <span class="k">do </span><span class="nb">echo</span> <span class="s2">&quot;$int: $(ifconfig $int | grep &quot;</span>inet addr:<span class="s2">&quot; | awk &#39;{print $2}&#39; | cut -d: -f2) =&gt; $(curl -s --interface $int ipv4.canhazip.info)&quot;</span>; <span class="k">done</span>
br0: 10.44.200.5 <span class="o">=</span>&gt; 89.242.208.82
br0:1: 10.44.200.15 <span class="o">=</span>&gt; 89.242.208.82
cluevpn: 10.156.1.49 <span class="o">=</span>&gt; 89.242.208.82
eth0: <span class="o">=</span>&gt;
vnet0: <span class="o">=</span>&gt;
</code></pre>
</div>


<p>Or if you want IPv6 addresses returned:</p>

<div class="highlight"><pre><code class="bash"><span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span><span class="k">for </span>int in <span class="k">$(</span>ifconfig | grep <span class="s2">&quot;Link encap:&quot;</span> | awk <span class="s1">&#39;{print $1}&#39;</span> | grep -v <span class="s1">&#39;lo&#39;</span><span class="k">)</span>; <span class="k">do </span><span class="nb">echo</span> <span class="s2">&quot;$int: $(ifconfig $int | grep &quot;</span>inet addr:<span class="s2">&quot; | awk &#39;{print $2}&#39; | cut -d: -f2) =&gt; $(curl -s --interface $int canhazip.info)&quot;</span>; <span class="k">done</span>
br0: 10.44.200.5 <span class="o">=</span>&gt; 2001:470:9083::2
br0:1: 10.44.200.15 <span class="o">=</span>&gt;
cluevpn: 10.156.1.49 <span class="o">=</span>&gt;
eth0: <span class="o">=</span>&gt;
vnet0: <span class="o">=</span>&gt;
</code></pre>
</div>



]]></summary>
    </entry>
    
    <entry>
        <title>MySQL uses no space on cPanel</title>
        <link href="http://damianzaremba.co.uk/2011/08/mysql-uses-no-space-on-cpanel//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/mysql-uses-no-space-on-cpanel//</id>
        <summary type="html"><![CDATA[<p>For some reason cPanel decided to start by default excluding sql databases from the disk usage stats.</p>

<p>To enable these again edit the /var/cpanel/cpanel.config file and change disk_usage_include_sqldbs from 0 to 1.</p>

<p>After running /scripts/update_db_cache you should now see disk stats in the interface once again.</p>

<p>Note: SQL database usage stats can be quite intensive to calculate so you may want to leave it off.</p>
]]></summary>
    </entry>
    
    <entry>
        <title>Install PostgreSQL on cPanel</title>
        <link href="http://damianzaremba.co.uk/2011/08/install-postgresql-on-cpanel//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/install-postgresql-on-cpanel//</id>
        <summary type="html"><![CDATA[<p>To install PostgreSQL on a cPanel server you can perform the following:</p>

<ol>
<li>Run /scripts/installpostgres</li>
<li>Go to SQL services -> Postgre config and click Install config</li>
<li>Configure a root password for Postgre
4 Enable Postgre with chkconfig postgres on; service postgres restart</li>
</ol>


<p>Now you would think that is it, right?
Well if you already have users on the box you will now need to add them into postgre otherwise they will have no access.</p>

<p>You can add them with the following script:</p>

<div class="highlight"><pre><code class="text">for user in $(ls /var/cpanel/users);
do
 su postgres -c &quot;createuser -S -D -R $user&quot;;
done
</code></pre>
</div>



]]></summary>
    </entry>
    
    <entry>
        <title>HTTP basic authentication - Apache</title>
        <link href="http://damianzaremba.co.uk/2011/08/http-basic-authentication-apache//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/http-basic-authentication-apache//</id>
        <summary type="html"><![CDATA[<p>Method 1)
Inside the directory you wish to protect include a .htaccess file with the following content:</p>

<div class="highlight"><pre><code class="text">AuthUserFile /some/secure/path/outside/the/public/docs/.htpasswd
AuthName &quot;My secure area&quot;
AuthType Basic
Require valid-user
</code></pre>
</div>


<p>Method 2)
In your apache config file add the following:</p>

<div class="highlight"><pre><code class="text">&lt;Directory /path/to/directory/to/protect/&gt;
 AuthUserFile /some/secure/path/outside/the/public/docs/.htpasswd
 AuthName &quot;My secure area&quot;
 AuthType Basic
 Require valid-user
&lt;/Directory&gt;
</code></pre>
</div>


<p>Now you have configured apache for authentication you need to create a password "databases". This is a file in a format apache can understand.</p>

<p>You can create it with the htpasswd command:</p>

<div class="highlight"><pre><code class="text">htpasswd -c /some/secure/path/outside/the/public/docs/.htpasswd myusername
</code></pre>
</div>


<p>Once you have your password database, if you need to update a users password or add more users you can use the htpasswd command without the -c option, like so:</p>

<div class="highlight"><pre><code class="text">htpasswd /some/secure/path/outside/the/public/docs/.htpasswd myusername
</code></pre>
</div>



]]></summary>
    </entry>
    
    <entry>
        <title>Getting rid of cPanel IP Check errors</title>
        <link href="http://damianzaremba.co.uk/2011/08/getting-rid-of-cpanel-ip-check-errors//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/getting-rid-of-cpanel-ip-check-errors//</id>
        <summary type="html"><![CDATA[<p>On Linux servers behind NAT you will start getting emails warning that the DNS setup is broken.</p>

<p>cPanel states that the panel does not work behind NAT and the boxes need <strong>public</strong> ip addresses.</p>

<p>It seems that apart from this warning the panel and services function fine behind NAT (as expected) and while I wouldn't recommend it, sometimes you have no choice.</p>

<p>The email you get though is something like the following:</p>

<div class="highlight"><pre><code class="text">[ipcheck] Problem with DNS setup on myserver.local

IMPORTANT: Do not ignore this email.

The hostname (myserver.local) resolves to 10.0.0.1. It should resolve to 192.168.0.1.
Please be sure to correct /etc/hosts as well as the &#39;A&#39; entry in zone file for the domain.

Some are all of these problems can be caused by /etc/resolv.conf being setup incorrectly.
Please check this file if you believe everything else is correct.
</code></pre>
</div>


<p>The best way I find of "fixing" this is to just disable the "Ip address dns check" option in the contact manager.</p>

<p>You could alternatively comment out the check in /scripts/maintenance, however this will be lost in updates.</p>
]]></summary>
    </entry>
    
    <entry>
        <title>Force PECL to install 64bit modules</title>
        <link href="http://damianzaremba.co.uk/2011/08/force-pecl-to-install-64bit-modules//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/force-pecl-to-install-64bit-modules//</id>
        <summary type="html"><![CDATA[<p>To ensure PECL installs 64bit modules you need to install the 64bit php-devel package.</p>

<p>On a RHEL system perform the following:</p>

<ol>
<li>pecl uninstall</li>
<li>yum remove php-devel.i386</li>
<li>yum install php-devel.x86_64</li>
<li>pecl install</li>
</ol>


<p>Any further modules will now be 64bit.</p>
]]></summary>
    </entry>
    
    <entry>
        <title>Fixing iptables for passive FTP</title>
        <link href="http://damianzaremba.co.uk/2011/08/fixing-iptables-for-passive-ftp//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/fixing-iptables-for-passive-ftp//</id>
        <summary type="html"><![CDATA[<p>To make passive FTP work with iptables you need to enable the "ip_conntrack_ftp" module. This is done by editing the /etc/sysconfig/iptables-config and changing</p>

<div class="highlight"><pre><code class="text">IPTABLES_MODULES=&quot;&quot;
</code></pre>
</div>


<p>To include the ip_conntrack_ftp module, like so:</p>

<div class="highlight"><pre><code class="text">IPTABLES_MODULES=&quot;ip_conntrack_ftp&quot;
</code></pre>
</div>


<p>Once this is done, restart iptables and it should play nicely with passive FTP.</p>
]]></summary>
    </entry>
    
    <entry>
        <title>Exim SMTP with multiple IPs and different HELO identifiers</title>
        <link href="http://damianzaremba.co.uk/2011/08/exim-smtp-with-multiple-ips-and-different-helo-identifiers//"/>
        <updated>2011-08-23T00:00:00+01:00</updated>
        <id>http://damianzaremba.co.uk/2011/08/exim-smtp-with-multiple-ips-and-different-helo-identifiers//</id>
        <summary type="html"><![CDATA[<p>To enable different helo commands on multiple IPs we need to utilize the Exim router and transport settings, these are available in Exim 4+.</p>

<p>The first thing we need to create is a custom Router, all the options are listed <a href="http://www.exim.org/exim-html-current/doc/html/spec_html/ch15.html">here</a> and <a href="http://www.exim.org/exim-html-current/doc/html/spec_html/ch17.html">here</a>.</p>

<p>An example router:</p>

<div class="highlight"><pre><code class="text">myrouter:
 driver = dnslookup
 senders = *@mydomain.com, *@*.mydomain.com
 transport = mytransport
</code></pre>
</div>


<p>The senders option is a CSV list of addresses to match in the From header. These can contain regex which makes matching whole domains really easy.</p>

<p>The transport option is a reference to your custom transport (see below).</p>

<p>Next we need to create a custom Transport, all the options are listed <a href="http://www.exim.org/exim-html-current/doc/html/spec_html/ch24.html">here</a> and <a href="http://www.exim.org/exim-html-current/doc/html/spec_html/ch30.html">here</a>.</p>

<p>An example transport is:</p>

<div class="highlight"><pre><code class="text">mytransport:
 driver = smtp
 interface = 192.168.0.1
 helo_data = mail.mydomain.com
</code></pre>
</div>


<p>The interface setting is the IP address this transport should be used on and the helo_data is the command to send.</p>

<p>This makes Exim an awesome platform for shared mail servers. It is very simple to offer whitelisting and protection against spammers.</p>
]]></summary>
    </entry>
    
</feed>

<!DOCTYPE HTML>
<html>
<head>
    <title>Damian Zaremba - Blog</title>

    <!-- General meta data -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="description" content="Damian Zaremba's Blog" />
    <meta name="google-site-verification" content="qykIg-4DghoGe78ET4eRjKG1cx6n3gXvu4jF0FvcwRo" />
    <meta name="author" content="Damian Zaremba" />
    <link rel="alternate" type="application/rss+xml" title="Damian Zaremba's Blog" href="http://feeds.feedburner.com/DamianZaremba" />

    <!-- Robot meta data -->
    <meta name="robots" content="INDEX" />
    <meta name="robots" content="FOLLOW" />
    <meta name="robots" content="INDEX,FOLLOW" />

    <!-- CSS files -->
    <link href="//www.damianzaremba.co.uk/assests/css/main.css" rel="stylesheet" type="text/css" />
    <link href="//www.damianzaremba.co.uk/assests/css/pygments.css" rel="stylesheet" type="text/css" />

    <!-- JS files -->
    <script src="//mint.damianzaremba.co.uk/?js" type="text/javascript"></script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-11817192-1']);
        _gaq.push(['_setDomainName', 'www.damianzaremba.co.uk']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www');
            ga.src += '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- IE fixes -->
    <!--[if IE]>
    body {
        behavior: url("//www.damianzaremba.co.uk/assests/other/hover.htc");
    }
    <![endif]-->

    <!--
    RIPA NOTICE: No consent is given for the interception of this page transmission
    -->
</head>
<body>
    <header>
        <h1><a href="/">Damian Zaremba</a> <span>Blog</span></h1>

        <nav>
            <ul id="main">
               <li><a href="/">Blog</a></li>
               <li><a href="/about">About</a></li>
               <li><a href="/cv">CV</a></li>
               <li><a href="/archives">Archives</a></li>
               <li><a href="/projects">Projects</a></li>
            </ul>
        </nav>

        <div id="right">
            <p>
                <a href="http://twitter.com/DamianZaremba">
                    <img src="//www.damianzaremba.co.uk/assests/images/twitter.png" alt="Twitter" />
                </a>
                <a href="https://plus.google.com/110559147647328161061">
                    <img src="//www.damianzaremba.co.uk/assests/images/googleplus.png" alt="GooglePlus" />
                </a>
                <a href="http://facebook.com/DamianZaremba">
                    <img src="//www.damianzaremba.co.uk/assests/images/facebook.png" alt="Facebook" />
                </a>
                <a href="https://github.com/DamianZaremba">
                    <img src="//www.damianzaremba.co.uk/assests/images/github.png" alt="GitHub" />
                </a>
                <a href="http://feeds.feedburner.com/DamianZaremba">
                    <img src="//www.damianzaremba.co.uk/assests/images/rss.png" alt="RSS" />
                </a>
            </p>
            <form class="search" action="http://google.com/search" method="get">
                <input class="left" type="text" name="q">
                <input type="hidden" name="q" value="site:www.damianzaremba.co.uk">
            </form>
        </div>
</header>

<div id="content">

    
    <article class="post">
        <h1 class="title"><a href="/2011/08/smtp-authentication-in-postfix-using-local-system-accounts/">SMTP Authentication in Postfix using local system accounts</a></h1>
        <div class="meta">
            <span><img src="/assests/images/date.png" title="Date" alt="Date" />23 Aug 2011</span>
            <span><img src="/assests/images/comments.png" title="Content" alt="Content" /><a href="/2011/08/smtp-authentication-in-postfix-using-local-system-accounts/#disqus_thread">Comments</a></span>
            
                <ul class="categories">
                <li><a href='/tag/foss'>FOSS</a></li><li><a href='/tag/knowledge-base'>Knowledge base</a></li><li><a href='/tag/linux'>Linux</a></li><li><a href='/tag/postfix'>Postfix</a></li><li><a href='/tag/email'>Email</a></li><li><a href='/tag/smtp'>Smtp</a></li></ul>
            
        </div>
        <div class="entry">
            <p>In /etc/postfix/main.cf ensure the following values are set</p>

<div class="highlight"><pre><code class="text">message_size_limit = 204800000
smtpd_recipient_restrictions = permit_sasl_authenticated permit_inet_interfaces reject_unauth_destination, permit
smtpd_sasl_auth_enable = yes
broken_sasl_auth_clients = yes
</code></pre></div>


<p>This will ensure postfix denies any un-authenticated attempts to send mail and enabled sasl authentication.</p>

<p>Next we just need to make sure sasl/postfix are setup to run:</p>

<div class="highlight"><pre><code class="bash">chkconfig saslauthd on
/etc/init.d/saslauthd restart
chkconfig postfix on
/etc/init.d/postfix restart
</code></pre></div>


<p>Once this is done all we need to do is add our users and they can send mail:</p>

<div class="highlight"><pre><code class="bash">adduser -s /sbin/nologin -M user1
passwd user1

adduser -s /sbin/nologin -M user2
passwd user2
</code></pre></div>




        </div>
    </article>
    
    <article class="post">
        <h1 class="title"><a href="/2011/08/recovering-deleted-files-from-the-handlers-in-proc/">Recovering deleted files from the handlers in /proc/</a></h1>
        <div class="meta">
            <span><img src="/assests/images/date.png" title="Date" alt="Date" />23 Aug 2011</span>
            <span><img src="/assests/images/comments.png" title="Content" alt="Content" /><a href="/2011/08/recovering-deleted-files-from-the-handlers-in-proc/#disqus_thread">Comments</a></span>
            
                <ul class="categories">
                <li><a href='/tag/apache'>Apache</a></li><li><a href='/tag/knowledge-base'>Knowledge base</a></li><li><a href='/tag/linux'>Linux</a></li><li><a href='/tag/apache'>Apache</a></li><li><a href='/tag/deleted-files'>Deleted files</a></li><li><a href='/tag/file-recovery'>File recovery</a></li><li><a href='/tag/proc'>Proc</a></li></ul>
            
        </div>
        <div class="entry">
            <p>On compromised servers it is very common for the exploit to delete its self/logs to try and hide its presence.</p>

<p>Even though the executable may be removed from the filesystem as the process is forked from apache the parent process will still have file handlers open.</p>

<p>This will allow you to recover log files/executables as long as you do not kill the process.</p>

<p>To recover the files use the following steps:</p>

<ol>
<li>Find the PID of the process with the open file handlers (use lsof)</li>
<li>cd /proc//fd where  is what you found using lsof above</li>
<li>ls -lra and you should see a load of broken symlinks (red)</li>
<li>Copy the file using cp into another directory</li>
</ol>


        </div>
    </article>
    
    <article class="post">
        <h1 class="title"><a href="/2011/08/quick-script-to-get-public-ips-on-a-natd-server/">Quick script to get public IPs on a NAT'd server</a></h1>
        <div class="meta">
            <span><img src="/assests/images/date.png" title="Date" alt="Date" />23 Aug 2011</span>
            <span><img src="/assests/images/comments.png" title="Content" alt="Content" /><a href="/2011/08/quick-script-to-get-public-ips-on-a-natd-server/#disqus_thread">Comments</a></span>
            
                <ul class="categories">
                <li><a href='/tag/foss'>FOSS</a></li><li><a href='/tag/fun'>Fun</a></li><li><a href='/tag/knowledge-base'>Knowledge base</a></li><li><a href='/tag/linux'>Linux</a></li><li><a href='/tag/bash'>Bash</a></li><li><a href='/tag/curl'>Curl</a></li><li><a href='/tag/ips'>Ips</a></li><li><a href='/tag/nat'>Nat</a></li></ul>
            
        </div>
        <div class="entry">
            <p>A quick one liner to get the public equivalent of internal IPs on a box behind NAT:</p>

<div class="highlight"><pre><code class="bash"><span class="k">for </span>int in <span class="k">$(</span>ifconfig <span class="p">|</span> grep <span class="s2">&quot;Link encap:&quot;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span> <span class="p">|</span> grep -v <span class="s1">&#39;lo&#39;</span><span class="k">)</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">&quot;$int: $(ifconfig $int | grep &quot;</span>inet addr:<span class="s2">&quot; | awk &#39;{print $2}&#39; | cut -d: -f2) =&gt; $(curl -s --interface $int ipv4.canhazip.info)&quot;</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div>


<p>I've restricted this to IPv4 only - NATing IPv6 is just silly but if you really want then it is on your head.</p>

<p>Example usage is as follows:</p>

<div class="highlight"><pre><code class="bash"><span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span><span class="k">for </span>int in <span class="k">$(</span>ifconfig <span class="p">|</span> grep <span class="s2">&quot;Link encap:&quot;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span> <span class="p">|</span> grep -v <span class="s1">&#39;lo&#39;</span><span class="k">)</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">&quot;$int: $(ifconfig $int | grep &quot;</span>inet addr:<span class="s2">&quot; | awk &#39;{print $2}&#39; | cut -d: -f2) =&gt; $(curl -s --interface $int ipv4.canhazip.info)&quot;</span><span class="p">;</span> <span class="k">done</span>
br0: 10.44.200.5 <span class="o">=</span>&gt; 89.242.208.82
br0:1: 10.44.200.15 <span class="o">=</span>&gt; 89.242.208.82
cluevpn: 10.156.1.49 <span class="o">=</span>&gt; 89.242.208.82
eth0: <span class="o">=</span>&gt;
vnet0: <span class="o">=</span>&gt;
</code></pre></div>


<p>Or if you want IPv6 addresses returned:</p>

<div class="highlight"><pre><code class="bash"><span class="o">[</span>damian@finnix ~<span class="o">]</span><span class="nv">$ </span><span class="k">for </span>int in <span class="k">$(</span>ifconfig <span class="p">|</span> grep <span class="s2">&quot;Link encap:&quot;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span> <span class="p">|</span> grep -v <span class="s1">&#39;lo&#39;</span><span class="k">)</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">&quot;$int: $(ifconfig $int | grep &quot;</span>inet addr:<span class="s2">&quot; | awk &#39;{print $2}&#39; | cut -d: -f2) =&gt; $(curl -s --interface $int canhazip.info)&quot;</span><span class="p">;</span> <span class="k">done</span>
br0: 10.44.200.5 <span class="o">=</span>&gt; 2001:470:9083::2
br0:1: 10.44.200.15 <span class="o">=</span>&gt;
cluevpn: 10.156.1.49 <span class="o">=</span>&gt;
eth0: <span class="o">=</span>&gt;
vnet0: <span class="o">=</span>&gt;
</code></pre></div>




        </div>
    </article>
    
    <article class="post">
        <h1 class="title"><a href="/2011/08/mysql-uses-no-space-on-cpanel/">MySQL uses no space on cPanel</a></h1>
        <div class="meta">
            <span><img src="/assests/images/date.png" title="Date" alt="Date" />23 Aug 2011</span>
            <span><img src="/assests/images/comments.png" title="Content" alt="Content" /><a href="/2011/08/mysql-uses-no-space-on-cpanel/#disqus_thread">Comments</a></span>
            
                <ul class="categories">
                <li><a href='/tag/cpanel'>Cpanel</a></li><li><a href='/tag/knowledge-base'>Knowledge base</a></li><li><a href='/tag/linux'>Linux</a></li><li><a href='/tag/cpanel.config'>Cpanel.config</a></li><li><a href='/tag/mysql'>Mysql</a></li></ul>
            
        </div>
        <div class="entry">
            <p>For some reason cPanel decided to start by default excluding sql databases from the disk usage stats.</p>

<p>To enable these again edit the /var/cpanel/cpanel.config file and change disk_usage_include_sqldbs from 0 to 1.</p>

<p>After running /scripts/update_db_cache you should now see disk stats in the interface once again.</p>

<p>Note: SQL database usage stats can be quite intensive to calculate so you may want to leave it off.</p>

        </div>
    </article>
    
    <article class="post">
        <h1 class="title"><a href="/2011/08/install-postgresql-on-cpanel/">Install PostgreSQL on cPanel</a></h1>
        <div class="meta">
            <span><img src="/assests/images/date.png" title="Date" alt="Date" />23 Aug 2011</span>
            <span><img src="/assests/images/comments.png" title="Content" alt="Content" /><a href="/2011/08/install-postgresql-on-cpanel/#disqus_thread">Comments</a></span>
            
                <ul class="categories">
                <li><a href='/tag/cpanel'>Cpanel</a></li><li><a href='/tag/knowledge-base'>Knowledge base</a></li><li><a href='/tag/postgresql'>Postgresql</a></li><li><a href='/tag/cpanel'>Cpanel</a></li><li><a href='/tag/hack'>Hack</a></li><li><a href='/tag/pgsql'>Pgsql</a></li><li><a href='/tag/postgresql'>Postgresql</a></li></ul>
            
        </div>
        <div class="entry">
            <p>To install PostgreSQL on a cPanel server you can perform the following:</p>

<ol>
<li>Run /scripts/installpostgres</li>
<li>Go to SQL services -> Postgre config and click Install config</li>
<li>Configure a root password for Postgre
4 Enable Postgre with chkconfig postgres on; service postgres restart</li>
</ol>


<p>Now you would think that is it, right?
Well if you already have users on the box you will now need to add them into postgre otherwise they will have no access.</p>

<p>You can add them with the following script:</p>

<div class="highlight"><pre><code class="text">for user in $(ls /var/cpanel/users);
do
 su postgres -c &quot;createuser -S -D -R $user&quot;;
done
</code></pre></div>




        </div>
    </article>
    



<nav id="page_nav">
    
    
    <a href="/3/" class="prev">&laquo; Previous Page</a>
    
    

    
    <a href="/5/" class="next">Next Page &raquo;</a>
    
</nav>


</div>

<footer>
    <p class="copyright">Copyright 2009-2014 <a href="http://www.damianzaremba.co.uk">Damian Zaremba</a></p>
    <ul id="ads">
        <li>Need error logging? Try <a href="https://getsentry.com/signup/r_D0ZW/">Sentry</a></li>
        <li>Need cloud instances? Jump on <a href="http://www.bigv.io">BigV</a></li>
        <li>Want my website? <a href="https://github.com/DamianZaremba/www.damianzaremba.co.uk/">Source</a></li>
    </ul>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
<!--[if lt IE 9]>
<script src="//www.damianzaremba.co.uk/assests/js/html5.js"></script>
<![endif]-->

<script type="text/javascript">
    !window.jQuery && document.write(unescape('%3Cscript src="//www.damianzaremba.co.uk/assests/js/jquery.js"%3E%3C/script%3E'))

    var disqus_shortname = 'damianzaremba';
    var disqus_script = 'count.js';

    (function () {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>
</body>
</html>

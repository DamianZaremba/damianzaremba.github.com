<!DOCTYPE html> <html lang=en> <head> <title>Damian Zaremba - Blog</title> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"> <meta http-equiv=Content-Type content="text/html; charset=UTF-8"/> <meta name=description content="Damian Zaremba's Blog"/> <meta name=google-site-verification content=qykIg-4DghoGe78ET4eRjKG1cx6n3gXvu4jF0FvcwRo /> <meta name=author content="Damian Zaremba"/> <link rel=alternate type="application/rss+xml" title="Damian Zaremba's Blog" href="http://feeds.feedburner.com/DamianZaremba"/> <meta name=robots content=INDEX /> <meta name=robots content=FOLLOW /> <meta name=robots content="INDEX,FOLLOW"/> <link href="/assests/css/bootstrap.min.css?v1" rel=stylesheet> <link href="/assests/css/main.css?v1" rel=stylesheet> </head> <body> <nav class="navbar navbar-default navbar-fixed-top"> <div class=container> <div class=navbar-header> <button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target="#navbar" aria-expanded=false aria-controls=navbar> <span class=sr-only>Open navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href="/">Damian Zaremba</a> </div> <div id=navbar> <div class="collapse navbar-collapse"> <ul class="nav navbar-nav"> <li class=active><a href="/">Blog</a></li> <li class=""><a href="/about/">About</a></li> <li class=""><a href="/cv/">CV</a></li> <li class=""><a href="/archive/">Archive</a></li> <li class=""><a href="/projects/">Projects</a></li> <li class=""><a href="/todo/">Todo</a></li> </ul> <div class="social-icons navbar-right"> <a href="http://twitter.com/DamianZaremba"> <img class=twitter src="/assests/images/twitter.png?v1" alt=Twitter /> </a> <a href="https://github.com/DamianZaremba"> <img class=github src="/assests/images/github.png?v1" alt=GitHub /> </a> <a href="http://feeds.feedburner.com/DamianZaremba"> <img class=rss src="/assests/images/rss.png?v1" alt=RSS /> </a> </div> </div> </div> </div> </nav> <div class=container> <article class=post> <h1 class=title><a href="/2014/08/quick-look-at-upgrading-to-centos-7/">A very quick look at upgrading CentOS 6.5 to 7.0</a></h1> <div class=meta> <span><img src="/assests/images/date.png" title=Date alt=Date />08 Aug 2014</span> <span><img src="/assests/images/comments.png" title=Content alt=Content /><a href="/2014/08/quick-look-at-upgrading-to-centos-7/#disqus_thread">Comments</a></span> <ul class=categories> <li><a href='/tag/linux'>Linux</a></li><li><a href='/tag/how-to'>How-to</a></li><li><a href='/tag/update'>Update</a></li></ul> </div> <div class=entry> <p>After some serious <a href="http://seven.centos.org/2014/07/guess-whats-coming/">seeding action</a> yesterday, today <a href="http://seven.centos.org/2014/07/release-announcement-for-centos-7x86_64/">CentOS 7</a> was released!</p> <p>As it happens I installed a new MSI Wind Box with CentOS 6.5 yesterday:</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># cat /etc/redhat-release</span>
CentOS release 6.5 <span class="o">(</span>Final<span class="o">)</span></p>

<p><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># uptime</span>
 20:57:41 up 22:57,  <span class="m">1</span> user,  load average: 0.00, 0.04, 0.05</code></pre></figure></p> <p>For the first time, there is a supported path for upgrading RHEL 6 to RHEL 7. Previously this would have been a reinstall.</p> <p>Disclaimer: I would not attempt the following upgrade on a production server yet. The upgrade tools are still under development and not considered to be working properly (See the <a href="http://lists.centos.org/pipermail/centos-devel/2014-July/011277.html">development mailing list post</a> if you want to help out).</p> <p>Since I have a new box that's not anywhere near production, what the hell... lets try this out.</p> <h2>First update to the latest CentOS 6 release</h2> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># yum update</span>
Loaded plugins: downloadonly, fastestmirror, security
Loading mirror speeds from cached hostfile
 * base: mirrors.coreix.net
 * epel: mirrors.mit.edu
 * extras: mirrors.coreix.net
 * updates: mirrors.clouvider.net
Setting up Update Process
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package initscripts.x86_64 0:9.03.40-2.el6.centos.1 will be updated
---&gt; Package initscripts.x86_64 0:9.03.40-2.el6.centos.2 will be an update
--&gt; Finished Dependency Resolution</p>

<p>Dependencies <span class="nv">Resolved</span></p>

<p><span class="o">=============================================================================================================================</span>
 Package                      Arch                    Version                                 Repository                <span class="nv">Size</span>
<span class="o">=============================================================================================================================</span>
Updating:
 initscripts                  x86_64                  9.03.40-2.el6.centos.2                  updates                  <span class="m">940</span> k</p>

<p>Transaction <span class="nv">Summary</span>
<span class="o">=============================================================================================================================</span>
Upgrade       <span class="m">1</span> Package<span class="o">(</span>s<span class="o">)</span></p>

<p>Total download size: <span class="m">940</span> k
Is this ok <span class="o">[</span>y/N<span class="o">]</span>: y
Downloading Packages:
initscripts-9.03.40-2.el6.centos.2.x86_64.rpm                                                         <span class="p">|</span> <span class="m">940</span> kB     00:00   <br/>
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Updating   : initscripts-9.03.40-2.el6.centos.2.x86_64                                                                 1/2
Jul  <span class="m">8</span> 20:58:08 pingu yum<span class="o">[</span>6374<span class="o">]</span>: Updated: initscripts-9.03.40-2.el6.centos.2.x86_64
  Cleanup    : initscripts-9.03.40-2.el6.centos.1.x86_64                                                                 2/2
  Verifying  : initscripts-9.03.40-2.el6.centos.2.x86_64                                                                 1/2
  Verifying  : initscripts-9.03.40-2.el6.centos.1.x86_64                                                                 2/2</p>

<p>Updated:
  initscripts.x86_64 0:9.03.40-2.el6.centos.2</p>

<p>Complete!</p>

<p><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># yum upgrade</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.clouvider.net
 * epel: mirror.vorboss.net
 * extras: centos.hyve.com
 * updates: centos.hyve.com
No packages marked <span class="k">for</span> update</code></pre></figure></p> <h2>Install the upgrade utils</h2> <p>These are still very much in dev and may explode all the things. See <a href="http://lists.centos.org/pipermail/centos-devel/2014-July/011277.html">http://lists.centos.org/pipermail/centos-devel/2014-July/011277.html</a> for details.</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># yum localinstall http://dev.centos.org/centos/6/upg/x86_64/Packages/preupgrade-assistant-1.0.2-33.el6.x86_64.rpm http://dev.centos.org/centos/6/upg/x86_64/Packages/preupgrade-assistant-contents-0.5.13-1.el6.noarch.rpm http://dev.centos.org/centos/6/upg/x86_64/Packages/python-rhsm-1.9.7-1.el6.x86_64.rpm http://dev.centos.org/centos/6/upg/x86_64/Packages/redhat-upgrade-tool-0.7.22-1.el6.noarch.rpm</span>
Loaded plugins: downloadonly, fastestmirror, security
Setting up Local Package Process
preupgrade-assistant-1.0.2-33.el6.x86_64.rpm                                                          <span class="p">|</span> <span class="m">438</span> kB     00:01   <br/>
Examining /var/tmp/yum-root-1lAuZF/preupgrade-assistant-1.0.2-33.el6.x86_64.rpm: preupgrade-assistant-1.0.2-33.el6.x86_64
Marking /var/tmp/yum-root-1lAuZF/preupgrade-assistant-1.0.2-33.el6.x86_64.rpm to be installed
Loading mirror speeds from cached hostfile
 * base: mirrors.coreix.net
 * epel: epel.mirror.constant.com
 * extras: mirrors.coreix.net
 * updates: mirrors.clouvider.net
preupgrade-assistant-contents-0.5.13-1.el6.noarch.rpm                                                 <span class="p">|</span> <span class="m">588</span> kB     00:01   <br/>
Examining /var/tmp/yum-root-1lAuZF/preupgrade-assistant-contents-0.5.13-1.el6.noarch.rpm: preupgrade-assistant-contents-0.5.13-1.el6.noarch
Marking /var/tmp/yum-root-1lAuZF/preupgrade-assistant-contents-0.5.13-1.el6.noarch.rpm to be installed
python-rhsm-1.9.7-1.el6.x86_64.rpm                                                                    <span class="p">|</span>  <span class="m">99</span> kB     00:00   <br/>
Examining /var/tmp/yum-root-1lAuZF/python-rhsm-1.9.7-1.el6.x86_64.rpm: python-rhsm-1.9.7-1.el6.x86_64
Marking /var/tmp/yum-root-1lAuZF/python-rhsm-1.9.7-1.el6.x86_64.rpm to be installed
redhat-upgrade-tool-0.7.22-1.el6.noarch.rpm                                                           <span class="p">|</span>  <span class="m">84</span> kB     00:00   <br/>
Examining /var/tmp/yum-root-1lAuZF/redhat-upgrade-tool-0.7.22-1.el6.noarch.rpm: 1:redhat-upgrade-tool-0.7.22-1.el6.noarch
Marking /var/tmp/yum-root-1lAuZF/redhat-upgrade-tool-0.7.22-1.el6.noarch.rpm to be installed
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package preupgrade-assistant.x86_64 0:1.0.2-33.el6 will be installed
--&gt; Processing Dependency: openscap<span class="o">(</span>x86-64<span class="o">)</span> &gt;<span class="o">=</span> 0.9.3-1 <span class="k">for</span> package: preupgrade-assistant-1.0.2-33.el6.x86_64
--&gt; Processing Dependency: pkgconfig<span class="o">(</span>libpcre<span class="o">)</span> <span class="k">for</span> package: preupgrade-assistant-1.0.2-33.el6.x86_64
--&gt; Processing Dependency: pkgconfig<span class="o">(</span>libxml-2.0<span class="o">)</span> <span class="k">for</span> package: preupgrade-assistant-1.0.2-33.el6.x86_64
--&gt; Processing Dependency: pkgconfig<span class="o">(</span>libxslt<span class="o">)</span> <span class="k">for</span> package: preupgrade-assistant-1.0.2-33.el6.x86_64
---&gt; Package preupgrade-assistant-contents.noarch 0:0.5.13-1.el6 will be installed
---&gt; Package python-rhsm.x86_64 0:1.9.7-1.el6 will be installed
--&gt; Processing Dependency: m2crypto <span class="k">for</span> package: python-rhsm-1.9.7-1.el6.x86_64
--&gt; Processing Dependency: python-simplejson <span class="k">for</span> package: python-rhsm-1.9.7-1.el6.x86_64
---&gt; Package redhat-upgrade-tool.noarch 1:0.7.22-1.el6 will be installed
--&gt; Running transaction check
---&gt; Package libxml2-devel.x86_64 0:2.7.6-14.el6_5.2 will be installed
--&gt; Processing Dependency: zlib-devel <span class="k">for</span> package: libxml2-devel-2.7.6-14.el6_5.2.x86_64
---&gt; Package libxslt-devel.x86_64 0:1.1.26-2.el6_3.1 will be installed
--&gt; Processing Dependency: libgcrypt-devel <span class="k">for</span> package: libxslt-devel-1.1.26-2.el6_3.1.x86_64
---&gt; Package m2crypto.x86_64 0:0.20.2-9.el6 will be installed
---&gt; Package openscap.x86_64 0:1.0.8-1.el6_5 will be installed
---&gt; Package pcre-devel.x86_64 0:7.8-6.el6 will be installed
---&gt; Package python-simplejson.x86_64 0:2.0.9-3.1.el6 will be installed
--&gt; Running transaction check
---&gt; Package libgcrypt-devel.x86_64 0:1.4.5-11.el6_4 will be installed
--&gt; Processing Dependency: libgpg-error-devel <span class="k">for</span> package: libgcrypt-devel-1.4.5-11.el6_4.x86_64
---&gt; Package zlib-devel.x86_64 0:1.2.3-29.el6 will be installed
--&gt; Running transaction check
---&gt; Package libgpg-error-devel.x86_64 0:1.7-4.el6 will be installed
--&gt; Finished Dependency Resolution</p>

<p>Dependencies <span class="nv">Resolved</span></p>

<p><span class="o">=============================================================================================================================</span>
 Package                          Arch      Version              Repository                                             <span class="nv">Size</span>
<span class="o">=============================================================================================================================</span>
Installing:
 preupgrade-assistant             x86_64    1.0.2-33.el6         /preupgrade-assistant-1.0.2-33.el6.x86_64             1.6 M
 preupgrade-assistant-contents    noarch    0.5.13-1.el6         /preupgrade-assistant-contents-0.5.13-1.el6.noarch    4.1 M
 python-rhsm                      x86_64    1.9.7-1.el6          /python-rhsm-1.9.7-1.el6.x86_64                       <span class="m">298</span> k
 redhat-upgrade-tool              noarch    1:0.7.22-1.el6       /redhat-upgrade-tool-0.7.22-1.el6.noarch              <span class="m">254</span> k
Installing <span class="k">for</span> dependencies:
 libgcrypt-devel                  x86_64    1.4.5-11.el6_4       base                                                  <span class="m">118</span> k
 libgpg-error-devel               x86_64    1.7-4.el6            base                                                   <span class="m">14</span> k
 libxml2-devel                    x86_64    2.7.6-14.el6_5.2     updates                                               1.1 M
 libxslt-devel                    x86_64    1.1.26-2.el6_3.1     base                                                  <span class="m">561</span> k
 m2crypto                         x86_64    0.20.2-9.el6         base                                                  <span class="m">471</span> k
 openscap                         x86_64    1.0.8-1.el6_5        updates                                               2.9 M
 pcre-devel                       x86_64    7.8-6.el6            base                                                  <span class="m">318</span> k
 python-simplejson                x86_64    2.0.9-3.1.el6        base                                                  <span class="m">126</span> k
 zlib-devel                       x86_64    1.2.3-29.el6         base                                                   <span class="m">44</span> k</p>

<p>Transaction <span class="nv">Summary</span>
<span class="o">=============================================================================================================================</span>
Install      <span class="m">13</span> Package<span class="o">(</span>s<span class="o">)</span></p>

<p>Total size: <span class="m">12</span> M
Total download size: 5.6 M
Installed size: <span class="m">64</span> M
Is this ok <span class="o">[</span>y/N<span class="o">]</span>: y
Downloading Packages:
<span class="o">(</span>1/9<span class="o">)</span>: libgcrypt-devel-1.4.5-11.el6_4.x86_64.rpm                                                      <span class="p">|</span> <span class="m">118</span> kB     00:00   <br/>
<span class="o">(</span>2/9<span class="o">)</span>: libgpg-error-devel-1.7-4.el6.x86_64.rpm                                                        <span class="p">|</span>  <span class="m">14</span> kB     00:00   <br/>
<span class="o">(</span>3/9<span class="o">)</span>: libxml2-devel-2.7.6-14.el6_5.2.x86_64.rpm                                                      <span class="p">|</span> 1.1 MB     00:00   <br/>
<span class="o">(</span>4/9<span class="o">)</span>: libxslt-devel-1.1.26-2.el6_3.1.x86_64.rpm                                                      <span class="p">|</span> <span class="m">561</span> kB     00:00   <br/>
<span class="o">(</span>5/9<span class="o">)</span>: m2crypto-0.20.2-9.el6.x86_64.rpm                                                               <span class="p">|</span> <span class="m">471</span> kB     00:00   <br/>
<span class="o">(</span>6/9<span class="o">)</span>: openscap-1.0.8-1.el6_5.x86_64.rpm                                                              <span class="p">|</span> 2.9 MB     00:01   <br/>
<span class="o">(</span>7/9<span class="o">)</span>: pcre-devel-7.8-6.el6.x86_64.rpm                                                                <span class="p">|</span> <span class="m">318</span> kB     00:00   <br/>
<span class="o">(</span>8/9<span class="o">)</span>: python-simplejson-2.0.9-3.1.el6.x86_64.rpm                                                     <span class="p">|</span> <span class="m">126</span> kB     00:00</p>

<h2><span class="o">(</span>9/9<span class="o">)</span>: zlib-devel-1.2.3-29.el6.x86_64.rpm                                                             <span class="p">|</span>  <span class="m">44</span> kB     00:00     </h2>

<p>Total                                                                                        2.1 MB/s <span class="p">|</span> 5.6 MB     00:02   <br/>
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : zlib-devel-1.2.3-29.el6.x86_64                                                                           1/13
  Installing : libxml2-devel-2.7.6-14.el6_5.2.x86_64                                                                    2/13
  Installing : libgpg-error-devel-1.7-4.el6.x86_64                                                                      3/13
  Installing : libgcrypt-devel-1.4.5-11.el6_4.x86_64                                                                    4/13
  Installing : libxslt-devel-1.1.26-2.el6_3.1.x86_64                                                                    5/13
  Installing : openscap-1.0.8-1.el6_5.x86_64                                                                            6/13
  Installing : m2crypto-0.20.2-9.el6.x86_64                                                                             7/13
  Installing : python-simplejson-2.0.9-3.1.el6.x86_64                                                                   8/13
  Installing : python-rhsm-1.9.7-1.el6.x86_64                                                                           9/13
  Installing : pcre-devel-7.8-6.el6.x86_64                                                                             10/13
  Installing : preupgrade-assistant-1.0.2-33.el6.x86_64                                                                11/13
  Installing : 1:redhat-upgrade-tool-0.7.22-1.el6.noarch                                                               12/13
  Installing : preupgrade-assistant-contents-0.5.13-1.el6.noarch                                                       13/13
  Verifying  : libgcrypt-devel-1.4.5-11.el6_4.x86_64                                                                    1/13
  Verifying  : pcre-devel-7.8-6.el6.x86_64                                                                              2/13
  Verifying  : python-simplejson-2.0.9-3.1.el6.x86_64                                                                   3/13
  Verifying  : python-rhsm-1.9.7-1.el6.x86_64                                                                           4/13
  Verifying  : 1:redhat-upgrade-tool-0.7.22-1.el6.noarch                                                                5/13
  Verifying  : preupgrade-assistant-contents-0.5.13-1.el6.noarch                                                        6/13
  Verifying  : m2crypto-0.20.2-9.el6.x86_64                                                                             7/13
  Verifying  : openscap-1.0.8-1.el6_5.x86_64                                                                            8/13
  Verifying  : libgpg-error-devel-1.7-4.el6.x86_64                                                                      9/13
  Verifying  : libxml2-devel-2.7.6-14.el6_5.2.x86_64                                                                   10/13
  Verifying  : libxslt-devel-1.1.26-2.el6_3.1.x86_64                                                                   11/13
  Verifying  : zlib-devel-1.2.3-29.el6.x86_64                                                                          12/13
  Verifying  : preupgrade-assistant-1.0.2-33.el6.x86_64                                                                13/13</p>

<p>Installed:
  preupgrade-assistant.x86_64 0:1.0.2-33.el6               preupgrade-assistant-contents.noarch 0:0.5.13-1.el6            <br/>
  python-rhsm.x86_64 0:1.9.7-1.el6                         redhat-upgrade-tool.noarch 1:0.7.22-1.el6</p>

<p>Dependency Installed:
  libgcrypt-devel.x86_64 0:1.4.5-11.el6_4  libgpg-error-devel.x86_64 0:1.7-4.el6     libxml2-devel.x86_64 0:2.7.6-14.el6_5.2
  libxslt-devel.x86_64 0:1.1.26-2.el6_3.1  m2crypto.x86_64 0:0.20.2-9.el6            openscap.x86_64 0:1.0.8-1.el6_5       <br/>
  pcre-devel.x86_64 0:7.8-6.el6            python-simplejson.x86_64 0:2.0.9-3.1.el6  zlib-devel.x86_64 0:1.2.3-29.el6</p>

<p>Complete!</code></pre></figure></p> <h2>Check for potential problems</h2> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># preupg</span>
Preupg tool doesn<span class="err">&#39;</span>t <span class="k">do</span> the actual upgrade.
Please ensure you have backed up your system and/or data in the event of a failed upgrade
 that would require a full re-install of the system from installation media.
Do you want to <span class="k">continue</span>? y/n
y
Gathering logs used by preupgrade assistant:
All installed packages : 01/10 ...finished <span class="o">(</span><span class="nb">time </span>00:00s<span class="o">)</span>
All changed files      : 02/10 ...finished <span class="o">(</span><span class="nb">time </span>01:09s<span class="o">)</span>
Changed config files   : 03/10 ...finished <span class="o">(</span><span class="nb">time </span>00:00s<span class="o">)</span>
All users              : 04/10 ...finished <span class="o">(</span><span class="nb">time </span>00:00s<span class="o">)</span>
All groups             : 05/10 ...finished <span class="o">(</span><span class="nb">time </span>00:00s<span class="o">)</span>
Service statuses       : 06/10 ...finished <span class="o">(</span><span class="nb">time </span>00:00s<span class="o">)</span>
All installed files    : 07/10 ...finished <span class="o">(</span><span class="nb">time </span>00:01s<span class="o">)</span>
All <span class="nb">local </span>files        : 08/10 ...finished <span class="o">(</span><span class="nb">time </span>00:01s<span class="o">)</span>
All executable files   : 09/10 ...finished <span class="o">(</span><span class="nb">time </span>00:00s<span class="o">)</span>
RedHat signed packages : 10/10 ...finished <span class="o">(</span><span class="nb">time </span>00:00s<span class="o">)</span>
Assessment of the system, running checks / SCE scripts:
001/100 ...done    <span class="o">(</span>Configuration Files to Review<span class="o">)</span>
002/100 ...done    <span class="o">(</span>File Lists <span class="k">for</span> Manual Migration<span class="o">)</span>
003/100 ...done    <span class="o">(</span>Bacula Backup Software<span class="o">)</span>
004/100 ...done    <span class="o">(</span>MySQL configuration<span class="o">)</span>
005/100 ...done    <span class="o">(</span>Migration of the MySQL data stack<span class="o">)</span>
006/100 ...done    <span class="o">(</span>General changes in default MySQL implementation<span class="o">)</span>
007/100 ...done    <span class="o">(</span>PostgreSQL upgrade content<span class="o">)</span>
008/100 ...done    <span class="o">(</span>GNOME Desktop Environment underwent several design modifications in Red Hat Enterprise Linux <span class="m">7</span> release<span class="o">)</span>
009/100 ...done    <span class="o">(</span>KDE Desktop Environment underwent several design modifications in Red Hat Enterprise Linux <span class="m">7</span> release<span class="o">)</span>
010/100 ...done    <span class="o">(</span>several graphic drivers not supported in Red Hat Enterprise Linux 7<span class="o">)</span>
011/100 ...done    <span class="o">(</span>several input drivers not supported in Red Hat Enterprise Linux 7<span class="o">)</span>
012/100 ...done    <span class="o">(</span>several kernel networking drivers not available in Red Hat Enterprise Linux 7<span class="o">)</span>
013/100 ...done    <span class="o">(</span>several kernel storage drivers not available in Red Hat Enterprise Linux 7<span class="o">)</span>
014/100 ...done    <span class="o">(</span>Names, Options and Output Format Changes in arptables<span class="o">)</span>
015/100 ...done    <span class="o">(</span>BIND9 running in a chroot environment check.<span class="o">)</span>
016/100 ...done    <span class="o">(</span>BIND9 configuration compatibility check<span class="o">)</span>
017/100 ...done    <span class="o">(</span>Move dhcpd/dhcprelay arguments from /etc/sysconfig/<em> to </em>.service files<span class="o">)</span>
018/100 ...done    <span class="o">(</span>DNSMASQ configuration compatibility check<span class="o">)</span>
019/100 ...done    <span class="o">(</span>Dovecot configuration compatibility check<span class="o">)</span>
020/100 ...done    <span class="o">(</span>Compatibility Between iptables and ip6tables<span class="o">)</span>
021/100 ...done    <span class="o">(</span>Net-SNMP check<span class="o">)</span>
022/100 ...done    <span class="o">(</span>Squid configuration compatibility check<span class="o">)</span>
023/100 ...done    <span class="o">(</span>Reusable Configuration Files<span class="o">)</span>
024/100 ...done    <span class="o">(</span>VCS repositories<span class="o">)</span>
025/100 ...done    <span class="o">(</span>Added and extended options <span class="k">for</span> BIND9 configuration<span class="o">)</span>
026/100 ...done    <span class="o">(</span>Added options in DNSMASQ configuration<span class="o">)</span>
027/100 ...done    <span class="o">(</span>Packages not signed by Red Hat<span class="o">)</span>
028/100 ...done    <span class="o">(</span>Obsoleted rpms<span class="o">)</span>
029/100 ...done    <span class="o">(</span>w3m not available in Red Hat Enterprise Linux 7<span class="o">)</span>
030/100 ...done    <span class="o">(</span>report incompatibilities between Red Hat Enterprise Linux <span class="m">6</span> and <span class="m">7</span> in qemu-guest-agent package<span class="o">)</span>
031/100 ...done    <span class="o">(</span>Removed options in coreutils binaries<span class="o">)</span>
032/100 ...done    <span class="o">(</span>Removed options in gawk binaries<span class="o">)</span>
033/100 ...done    <span class="o">(</span>Removed options in netstat binary<span class="o">)</span>
034/100 ...done    <span class="o">(</span>Removed options in quota tools<span class="o">)</span>
035/100 ...done    <span class="o">(</span>Removed rpms<span class="o">)</span>
036/100 ...done    <span class="o">(</span>Replaced rpms<span class="o">)</span>
037/100 ...done    <span class="o">(</span>GMP library incompatibilities<span class="o">)</span>
038/100 ...done    <span class="o">(</span>optional channel problems<span class="o">)</span>
039/100 ...done    <span class="o">(</span>package downgrades<span class="o">)</span>
040/100 ...done    <span class="o">(</span>restore custom selinux configuration<span class="o">)</span>
041/100 ...done    <span class="o">(</span>General<span class="o">)</span>
042/100 ...done    <span class="o">(</span>samba shared directories selinux<span class="o">)</span>
043/100 ...done    <span class="o">(</span>CUPS Browsing/BrowsePoll configuration<span class="o">)</span>
044/100 ...done    <span class="o">(</span>CVS Package Split<span class="o">)</span>
045/100 ...done    <span class="o">(</span>FreeRADIUS Upgrade Verification<span class="o">)</span>
046/100 ...done    <span class="o">(</span>httpd configuration compatibility check<span class="o">)</span>
047/100 ...done    <span class="o">(</span><span class="nb">bind</span>-dyndb-ldap<span class="o">)</span>
048/100 ...done    <span class="o">(</span>Identity Management Server compatibility check<span class="o">)</span>
049/100 ...done    <span class="o">(</span>IPA Server CA Verification<span class="o">)</span>
050/100 ...done    <span class="o">(</span>NTP configuration<span class="o">)</span>
051/100 ...done    <span class="o">(</span>Information on <span class="nb">time</span>-sync.target<span class="o">)</span>
052/100 ...done    <span class="o">(</span>OpenLDAP /etc/sysconfig and data compatibility<span class="o">)</span>
053/100 ...done    <span class="o">(</span>OpenSSH sshd_config migration content<span class="o">)</span>
054/100 ...done    <span class="o">(</span>OpenSSH sysconfig migration content<span class="o">)</span>
055/100 ...done    <span class="o">(</span>Configuration <span class="k">for</span> quota_nld service<span class="o">)</span>
056/100 ...done    <span class="o">(</span>Disk quota netlink message daemon moved into quota-nld package<span class="o">)</span>
057/100 ...done    <span class="o">(</span>SSSD compatibility check<span class="o">)</span>
058/100 ...done    <span class="o">(</span>Luks encrypted partition<span class="o">)</span>
059/100 ...done    <span class="o">(</span>Clvmd and cmirrord daemon management.<span class="o">)</span>
060/100 ...done    <span class="o">(</span>State of LVM2 services.<span class="o">)</span>
061/100 ...done    <span class="o">(</span>device-mapper-multipath configuration compatibility check<span class="o">)</span>
062/100 ...done    <span class="o">(</span>Removal of scsi-target-utils<span class="o">)</span>
063/100 ...done    <span class="o">(</span>Configuration <span class="k">for</span> warnquota tool<span class="o">)</span>
064/100 ...done    <span class="o">(</span>Disk quota tool warnquota moved into quota-warnquota package<span class="o">)</span>
065/100 ...done    <span class="o">(</span>Check <span class="k">for</span> Add-On availability<span class="o">)</span>
066/100 ...done    <span class="o">(</span>Architecture Support<span class="o">)</span>
067/100 ...done    <span class="o">(</span>Binary rebuilds<span class="o">)</span>
068/100 ...done    <span class="o">(</span>Debuginfo packages<span class="o">)</span>
069/100 ...done    <span class="o">(</span>Cluster and High Availablility<span class="o">)</span>
070/100 ...done    <span class="o">(</span>fix krb5kdc config file<span class="o">)</span>
071/100 ...done    <span class="o">(</span>File Systems, Partitions and Mounts Configuration Review<span class="o">)</span>
072/100 ...done    <span class="o">(</span>Read Only FHS directories<span class="o">)</span>
073/100 ...done    <span class="o">(</span>Red Hat Enterprise Linux Server variant<span class="o">)</span>
074/100 ...done    <span class="o">(</span>Sonamebumped libs<span class="o">)</span>
075/100 ...done    <span class="o">(</span>SonameKept Reusable Dynamic Libraries<span class="o">)</span>
076/100 ...done    <span class="o">(</span>Removed .so libs<span class="o">)</span>
077/100 ...done    <span class="o">(</span>In-place Upgrade Requirements <span class="k">for</span> the /usr/ Directory<span class="o">)</span>
078/100 ...done    <span class="o">(</span>CA certificate bundles modified<span class="o">)</span>
079/100 ...done    <span class="o">(</span>Developer Tool Set packages<span class="o">)</span>
080/100 ...done    <span class="o">(</span>Hyper-V<span class="o">)</span>
081/100 ...done    <span class="o">(</span>Content <span class="k">for</span> enabling and disabling services based on RHEL <span class="m">6</span> system<span class="o">)</span>
082/100 ...done    <span class="o">(</span>Check <span class="k">for</span> ethernet interface naming<span class="o">)</span>
083/100 ...done    <span class="o">(</span>User modification in /etc/rc.local and /etc/rc.d/rc.local<span class="o">)</span>
084/100 ...done    <span class="o">(</span>cgroups configuration compatibility check<span class="o">)</span>
085/100 ...done    <span class="o">(</span>Plugable authentication modules <span class="o">(</span>PAM<span class="o">))</span>
086/100 ...done    <span class="o">(</span>Foreign Perl modules<span class="o">)</span>
087/100 ...done    <span class="o">(</span>Python 2.7.5<span class="o">)</span>
088/100 ...done    <span class="o">(</span>Ruby 2.0.0<span class="o">)</span>
089/100 ...done    <span class="o">(</span>SCL collections<span class="o">)</span>
090/100 ...done    <span class="o">(</span>Red Hat Subscription Manager<span class="o">)</span>
091/100 ...done    <span class="o">(</span>Red Hat Network Classic Unsupported<span class="o">)</span>
092/100 ...done    <span class="o">(</span>System kickstart<span class="o">)</span>
093/100 ...done    <span class="o">(</span>YUM<span class="o">)</span>
094/100 ...done    <span class="o">(</span>Check <span class="k">for</span> usage of dangerous range of UID/GIDs<span class="o">)</span>
095/100 ...done    <span class="o">(</span>Incorrect usage of reserved UID/GIDs<span class="o">)</span>
096/100 ...done    <span class="o">(</span>NIS ypbind config files back-up<span class="o">)</span>
097/100 ...done    <span class="o">(</span>NIS Makefile back-up<span class="o">)</span>
098/100 ...done    <span class="o">(</span>NIS server maps check<span class="o">)</span>
099/100 ...done    <span class="o">(</span>NIS server MAXUID and MAXGID limits check<span class="o">)</span>
100/100 ...done    <span class="o">(</span>NIS server config file back-up<span class="o">)</span>
Assessment finished <span class="o">(</span><span class="nb">time </span>00:00s<span class="o">)</span></p>

<h2>Result table with checks and their results <span class="k">for</span> main contents:</h2>

<p><span class="p">|</span>Configuration Files to Review                                                                               <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>File Lists <span class="k">for</span> Manual Migration                                                                             <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Bacula Backup Software                                                                                      <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>MySQL configuration                                                                                         <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Migration of the MySQL data stack                                                                           <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>General changes in default MySQL implementation                                                             <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>PostgreSQL upgrade content                                                                                  <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>GNOME Desktop Environment underwent several design modifications in Red Hat Enterprise Linux <span class="m">7</span> release      <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>KDE Desktop Environment underwent several design modifications in Red Hat Enterprise Linux <span class="m">7</span> release        <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>several graphic drivers not supported in Red Hat Enterprise Linux <span class="m">7</span>                                         <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>several input drivers not supported in Red Hat Enterprise Linux <span class="m">7</span>                                           <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>several kernel networking drivers not available in Red Hat Enterprise Linux <span class="m">7</span>                               <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>several kernel storage drivers not available in Red Hat Enterprise Linux <span class="m">7</span>                                  <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Names, Options and Output Format Changes in arptables                                                       <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>BIND9 running in a chroot environment check.                                                                <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>BIND9 configuration compatibility check                                                                     <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Move dhcpd/dhcprelay arguments from /etc/sysconfig/<em> to </em>.service files                                     <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>DNSMASQ configuration compatibility check                                                                   <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Dovecot configuration compatibility check                                                                   <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Compatibility Between iptables and ip6tables                                                                <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Net-SNMP check                                                                                              <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Squid configuration compatibility check                                                                     <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Reusable Configuration Files                                                                                <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>VCS repositories                                                                                            <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Added and extended options <span class="k">for</span> BIND9 configuration                                                          <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Added options in DNSMASQ configuration                                                                      <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Packages not signed by Red Hat                                                                              <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Obsoleted rpms                                                                                              <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>w3m not available in Red Hat Enterprise Linux <span class="m">7</span>                                                             <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>report incompatibilities between Red Hat Enterprise Linux <span class="m">6</span> and <span class="m">7</span> in qemu-guest-agent package               <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Removed options in coreutils binaries                                                                       <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Removed options in gawk binaries                                                                            <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Removed options in netstat binary                                                                           <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Removed options in quota tools                                                                              <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Removed rpms                                                                                                <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Replaced rpms                                                                                               <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>GMP library incompatibilities                                                                               <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>optional channel problems                                                                                   <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>package downgrades                                                                                          <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>restore custom selinux configuration                                                                        <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>General                                                                                                     <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>samba shared directories selinux                                                                            <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>CUPS Browsing/BrowsePoll configuration                                                                      <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>CVS Package Split                                                                                           <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>FreeRADIUS Upgrade Verification                                                                             <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>httpd configuration compatibility check                                                                     <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span><span class="nb">bind</span>-dyndb-ldap                                                                                             <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Identity Management Server compatibility check                                                              <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>IPA Server CA Verification                                                                                  <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>NTP configuration                                                                                           <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Information on <span class="nb">time</span>-sync.target                                                                             <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>OpenLDAP /etc/sysconfig and data compatibility                                                              <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>OpenSSH sshd_config migration content                                                                       <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>OpenSSH sysconfig migration content                                                                         <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Configuration <span class="k">for</span> quota_nld service                                                                         <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Disk quota netlink message daemon moved into quota-nld package                                              <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>SSSD compatibility check                                                                                    <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Luks encrypted partition                                                                                    <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Clvmd and cmirrord daemon management.                                                                       <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>State of LVM2 services.                                                                                     <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>device-mapper-multipath configuration compatibility check                                                   <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Removal of scsi-target-utils                                                                                <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Configuration <span class="k">for</span> warnquota tool                                                                            <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Disk quota tool warnquota moved into quota-warnquota package                                                <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Check <span class="k">for</span> Add-On availability                                                                               <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Architecture Support                                                                                        <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Binary rebuilds                                                                                             <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Debuginfo packages                                                                                          <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Cluster and High Availablility                                                                              <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>fix krb5kdc config file                                                                                     <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>File Systems, Partitions and Mounts Configuration Review                                                    <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Read Only FHS directories                                                                                   <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Red Hat Enterprise Linux Server variant                                                                     <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Sonamebumped libs                                                                                           <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>SonameKept Reusable Dynamic Libraries                                                                       <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Removed .so libs                                                                                            <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>In-place Upgrade Requirements <span class="k">for</span> the /usr/ Directory                                                       <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>CA certificate bundles modified                                                                             <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Developer Tool Set packages                                                                                 <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Hyper-V                                                                                                     <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Content <span class="k">for</span> enabling and disabling services based on RHEL <span class="m">6</span> system                                          <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Check <span class="k">for</span> ethernet interface naming                                                                         <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>User modification in /etc/rc.local and /etc/rc.d/rc.local                                                   <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>cgroups configuration compatibility check                                                                   <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Plugable authentication modules <span class="o">(</span>PAM<span class="o">)</span>                                                                       <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Foreign Perl modules                                                                                        <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Python 2.7.5                                                                                                <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Ruby 2.0.0                                                                                                  <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>SCL collections                                                                                             <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Red Hat Network Classic Unsupported                                                                         <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Red Hat Subscription Manager                                                                                <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>System kickstart                                                                                            <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>YUM                                                                                                         <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Check <span class="k">for</span> usage of dangerous range of UID/GIDs                                                              <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>Incorrect usage of reserved UID/GIDs                                                                        <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>NIS ypbind config files back-up                                                                             <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>NIS Makefile back-up                                                                                        <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>NIS server maps check                                                                                       <span class="p">|</span>notapplicable  <span class="p">|</span>
<span class="p">|</span>NIS server MAXUID and MAXGID limits check                                                                   <span class="p">|</span>notapplicable  <span class="p">|</span></p>

<h2><span class="p">|</span>NIS server config file back-up                                                                              <span class="p">|</span>notapplicable  <span class="p">|</span></h2>

<p>Tarball with results is stored here /root/preupgrade-results/preupg_results-140708210602.tar.gz .
The latest assessment is stored in directory /root/preupgrade .
Upload results to UI by <span class="nb">command</span>:
e.g. preupg -u http://127.0.0.1:8099/submit/ -r /root/preupgrade-results/preupg_results-*.tar.gz .</code></pre></figure></p> <p>Hopefully everything looks ok and you can continue with the upgrade.</p> <h2>Run the upgrade</h2> <p>This tool basically downloads a custom kernel which does the actual upgrade.</p> <p>This should work</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash">redhat-upgrade-tool-cli http://mirror.bytemark.co.uk/centos/7/os/x86_64/</code></pre></figure></p> <p>However it fails as below</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># redhat-upgrade-tool-cli --instrepo=http://mirror.bytemark.co.uk/centos/7/os/x86_64/ --network=7 --force --disablerepo=epel</span>
setting up repos...
No upgrade available <span class="k">for</span> the following repos: scl
.treeinfo                                                                                                                        <span class="p">|</span> 1.1 kB     00:00   <br/>
getting boot images...
setting up update...
verify <span class="nb">local </span>files 100% <span class="o">[==============================================================================================================================]</span>
<span class="o">(</span>1/5<span class="o">)</span>: libdwarf-20130207-3.el7.x86_64.rpm                                                                                        <span class="p">|</span> <span class="m">109</span> kB     00:00   <br/>
<span class="o">(</span>2/5<span class="o">)</span>: python-dns-1.10.0-5.el7.noarch.rpm                                                                                        <span class="p">|</span> <span class="m">220</span> kB     00:00   <br/>
<span class="o">(</span>3/5<span class="o">)</span>: qpdf-libs-5.0.1-3.el7.x86_64.rpm                                                                                          <span class="p">|</span> <span class="m">328</span> kB     00:00   <br/>
<span class="o">(</span>4/5<span class="o">)</span>: qrencode-libs-3.4.1-3.el7.x86_64.rpm                                                                                      <span class="p">|</span>  <span class="m">50</span> kB     00:00   <br/>
<span class="o">(</span>5/5<span class="o">)</span>: satyr-0.13-4.el7.x86_64.rpm                                                                                               <span class="p">|</span> <span class="m">500</span> kB     00:00   <br/>
warning: rpmts_HdrFromFdno: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</p>

<p>Downloading failed: The GPG keys listed <span class="k">for</span> the <span class="s2">&quot;CentOS-7.0 - Base&quot;</span> repository are already installed but they are not correct <span class="k">for</span> this package.
Check that the correct key URLs are configured <span class="k">for</span> this repository.</code></pre></figure></p> <p>So I thought.... ok, for now we'll trust the packages and not check the GPG keys. However there also seems to be a problem in detecting preupg. We ran preupg first, to check the system however the upgrade tool thinks we havn't and fails as below</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># redhat-upgrade-tool-cli --instrepo=http://mirror.bytemark.co.uk/centos/7/os/x86_64/ --network=7 --nogpgcheck</span>
setting up repos...
base                                                                                                                             <span class="p">|</span> 3.6 kB     00:00   <br/>
base/primary_db                                                                                                                  <span class="p">|</span> 4.9 MB     00:01   <br/>
cmdline-instrepo                                                                                                                 <span class="p">|</span> 3.6 kB     00:00   <br/>
cmdline-instrepo/primary_db                                                                                                      <span class="p">|</span> 4.9 MB     00:01   <br/>
epel/metalink                                                                                                                    <span class="p">|</span>  <span class="m">26</span> kB     00:00   <br/>
epel                                                                                                                             <span class="p">|</span> 4.4 kB     00:00   <br/>
epel/primary_db                                                                                                                  <span class="p">|</span> 6.2 MB     00:03   <br/>
extras                                                                                                                           <span class="p">|</span> 2.9 kB     00:00   <br/>
extras/primary_db                                                                                                                <span class="p">|</span>  <span class="m">15</span> kB     00:00   <br/>
updates                                                                                                                          <span class="p">|</span> 2.9 kB     00:00   <br/>
updates/primary_db                                                                                                               <span class="p">|</span> 1.4 MB     00:00   <br/>
No upgrade available <span class="k">for</span> the following repos: scl
.treeinfo                                                                                                                        <span class="p">|</span> 1.1 kB     00:00   <br/>
preupgrade-assistant has not been run.
To perform this upgrade, either run preupg or run redhat-upgrade-tool --force</code></pre></figure></p> <p>I finally ended up disabling both GPG encryption and forcing the run (to skip the preupg)</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># redhat-upgrade-tool-cli --instrepo=http://mirror.bytemark.co.uk/centos/7/os/x86_64/ --network=7 --force --nogpgcheck</span>
setting up repos...
No upgrade available <span class="k">for</span> the following repos: scl
.treeinfo                                                                                                                        <span class="p">|</span> 1.1 kB     00:00   <br/>
getting boot images...
setting up update...
verify <span class="nb">local </span>files 100% <span class="o">[==============================================================================================================================]</span>
redhat_upgrade_tool.yum WARNING: Error loading productid metadata <span class="k">for</span> base.
redhat_upgrade_tool.yum WARNING: Error loading productid metadata <span class="k">for</span> epel.
redhat_upgrade_tool.yum WARNING: Error loading productid metadata <span class="k">for</span> extras.
redhat_upgrade_tool.yum WARNING: Error loading productid metadata <span class="k">for</span> updates.
testing upgrade transaction
rpm transaction 100% <span class="o">[=================================================================================================================================]</span>
rpm install 100% <span class="o">[=====================================================================================================================================]</span>
setting up system <span class="k">for</span> upgrade
Finished. Reboot to start upgrade.</code></pre></figure></p> <p>Booom - we're getting somewhere. Now we reboot into the kernel that has been installed.</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># reboot</span></code></pre></figure></p> <p>At this point go get a cup of tea or something - the upgrade kernel basically downloads all the required packages from yum and then reboots into a working system.</p> <h2>The system booted up!</h2> <p>Since there isn't a SCL repo for 7 yet - we need to clean this up</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># rm -f /etc/yum.repos.d/CentOS-SCL.repo</span></code></pre></figure></p> <p>I also have EPEL installed on this server - lets fix that up.....</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># wget -O /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7 http://mirror.bytemark.co.uk/fedora/epel/RPM-GPG-KEY-EPEL-7</span>
<span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># sed -i &#39;s/6/7/g&#39; /etc/yum.repos.d/epel.repo </span></code></pre></figure></p> <h2>Update packages</h2> <p>At this point CentOS 7 should update cleanly</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># yum update</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.clouvider.net
 * epel: mirror.vorboss.net
 * extras: centos.hyve.com
 * updates: centos.hyve.com
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package epel-release.noarch 0:6-8 will be updated
---&gt; Package epel-release.noarch 0:7-0.2 will be an update
---&gt; Package htop.x86_64 0:1.0.1-2.el6 will be updated
---&gt; Package htop.x86_64 0:1.0.3-3.el7 will be an update
---&gt; Package python-crypto.x86_64 0:2.0.1-22.el6 will be updated
---&gt; Package python-crypto.x86_64 0:2.6.1-1.el7 will be an update
---&gt; Package python-paramiko.noarch 0:1.7.5-2.1.el6 will be updated
---&gt; Package python-paramiko.noarch 0:1.11.3-1.el7 will be an update
---&gt; Package python-simplejson.x86_64 0:2.0.9-3.1.el6 will be updated
---&gt; Package python-simplejson.x86_64 0:3.3.3-1.el7 will be an update
--&gt; Finished Dependency Resolution</p>

<p>Dependencies <span class="nv">Resolved</span></p>

<p><span class="o">========================================================================================================================================================</span>
 Package                                    Arch                            Version                                 Repository                     <span class="nv">Size</span>
<span class="o">========================================================================================================================================================</span>
Updating:
 epel-release                               noarch                          7-0.2                                   epel                           <span class="m">13</span> k
 htop                                       x86_64                          1.0.3-3.el7                             epel                           <span class="m">87</span> k
 python-crypto                              x86_64                          2.6.1-1.el7                             epel                          <span class="m">469</span> k
 python-paramiko                            noarch                          1.11.3-1.el7                            epel                          <span class="m">678</span> k
 python-simplejson                          x86_64                          3.3.3-1.el7                             epel                          <span class="m">171</span> k</p>

<p>Transaction <span class="nv">Summary</span>
<span class="o">========================================================================================================================================================</span>
Upgrade  <span class="m">5</span> Packages</p>

<p>Total size: 1.4 M
Is this ok <span class="o">[</span>y/d/N<span class="o">]</span>: y
Downloading packages:
warning: /var/cache/yum/x86_64/7/epel/packages/epel-release-7-0.2.noarch.rpm: Header V3 RSA/SHA256 Signature, key ID 352c64e5: NOKEY
Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
Importing GPG key 0x352C64E5:
 Userid     : <span class="s2">&quot;Fedora EPEL (7) &lt;epel@fedoraproject.org&gt;&quot;</span>
 Fingerprint: 91e9 7d7c 4a5e 96f1 7f3e 888f 6a2f aea2 352c 64e5
 From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
Is this ok <span class="o">[</span>y/N<span class="o">]</span>: y
Running transaction check
Running transaction <span class="nb">test</span>
Transaction <span class="nb">test </span>succeeded
Running transaction
Warning: RPMDB altered outside of yum.
** Found <span class="m">20</span> pre-existing rpmdb problem<span class="o">(</span>s<span class="o">)</span>, <span class="s1">&#39;yum check&#39;</span> output follows:
aiccu-2007.01.15-7.el6.x86_64 has missing requires of libgnutls.so.26<span class="o">()(</span>64bit<span class="o">)</span>
aiccu-2007.01.15-7.el6.x86_64 has missing requires of libgnutls.so.26<span class="o">(</span>GNUTLS_1_4<span class="o">)(</span>64bit<span class="o">)</span>
cas-0.15-1.el6.1.noarch has missing requires of python<span class="o">(</span>abi<span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="s1">&#39;0&#39;</span>, <span class="s1">&#39;2.6&#39;</span>, None<span class="o">)</span>
10:centos-release-SCL-6-5.el6.centos.x86_64 has missing requires of centos-release <span class="o">=</span> <span class="o">(</span><span class="s1">&#39;0&#39;</span>, <span class="s1">&#39;6&#39;</span>, None<span class="o">)</span>
cloog-ppl-0.15.7-1.2.el6.x86_64 has missing requires of libgmp.so.3<span class="o">()(</span>64bit<span class="o">)</span>
hal-info-20090716-3.1.el6.noarch has missing requires of hal &gt;<span class="o">=</span> <span class="o">(</span><span class="s1">&#39;0&#39;</span>, <span class="s1">&#39;0.5.10&#39;</span>, None<span class="o">)</span>
openscap-1.0.8-1.el6_5.x86_64 has missing requires of libpcre.so.0<span class="o">()(</span>64bit<span class="o">)</span>
openscap-1.0.8-1.el6_5.x86_64 has missing requires of librpm.so.1<span class="o">()(</span>64bit<span class="o">)</span>
openscap-1.0.8-1.el6_5.x86_64 has missing requires of librpmio.so.1<span class="o">()(</span>64bit<span class="o">)</span>
ppl-0.10.2-11.el6.x86_64 has missing requires of libgmp.so.3<span class="o">()(</span>64bit<span class="o">)</span>
preupgrade-assistant-1.0.2-33.el6.x86_64 has missing requires of libpcre.so.0<span class="o">()(</span>64bit<span class="o">)</span>
preupgrade-assistant-1.0.2-33.el6.x86_64 has missing requires of librpm.so.1<span class="o">()(</span>64bit<span class="o">)</span>
preupgrade-assistant-1.0.2-33.el6.x86_64 has missing requires of librpmio.so.1<span class="o">()(</span>64bit<span class="o">)</span>
preupgrade-assistant-1.0.2-33.el6.x86_64 has missing requires of python<span class="o">(</span>abi<span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="s1">&#39;0&#39;</span>, <span class="s1">&#39;2.6&#39;</span>, None<span class="o">)</span>
python-dns-1.11.1-2.el6.noarch has missing requires of python<span class="o">(</span>abi<span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="s1">&#39;0&#39;</span>, <span class="s1">&#39;2.6&#39;</span>, None<span class="o">)</span>
python-iwlib-0.1-1.2.el6.x86_64 has missing requires of libpython2.6.so.1.0<span class="o">()(</span>64bit<span class="o">)</span>
python-iwlib-0.1-1.2.el6.x86_64 has missing requires of python<span class="o">(</span>abi<span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="s1">&#39;0&#39;</span>, <span class="s1">&#39;2.6&#39;</span>, None<span class="o">)</span>
qpdf-libs-5.1.1-2.el6.x86_64 has missing requires of libpcre.so.0<span class="o">()(</span>64bit<span class="o">)</span>
1:readahead-1.5.6-2.el6.x86_64 has missing requires of upstart
satyr-0.14-1.el6.x86_64 has missing requires of librpm.so.1<span class="o">()(</span>64bit<span class="o">)</span>
  Updating   : python-crypto-2.6.1-1.el7.x86_64                                                                                                    1/10
  Updating   : python-paramiko-1.11.3-1.el7.noarch                                                                                                 2/10
  Updating   : python-simplejson-3.3.3-1.el7.x86_64                                                                                                3/10
  Updating   : htop-1.0.3-3.el7.x86_64                                                                                                             4/10
  Updating   : epel-release-7-0.2.noarch                                                                                                           5/10
warning: /etc/yum.repos.d/epel.repo saved as /etc/yum.repos.d/epel.repo.rpmsave
  Cleanup    : python-paramiko-1.7.5-2.1.el6.noarch                                                                                                6/10
  Cleanup    : epel-release-6-8.noarch                                                                                                             7/10
  Cleanup    : python-crypto-2.0.1-22.el6.x86_64                                                                                                   8/10
  Cleanup    : python-simplejson-2.0.9-3.1.el6.x86_64                                                                                              9/10
  Cleanup    : htop-1.0.1-2.el6.x86_64                                                                                                            10/10
  Verifying  : epel-release-7-0.2.noarch                                                                                                           1/10
  Verifying  : python-crypto-2.6.1-1.el7.x86_64                                                                                                    2/10
  Verifying  : htop-1.0.3-3.el7.x86_64                                                                                                             3/10
  Verifying  : python-simplejson-3.3.3-1.el7.x86_64                                                                                                4/10
  Verifying  : python-paramiko-1.11.3-1.el7.noarch                                                                                                 5/10
  Verifying  : python-simplejson-2.0.9-3.1.el6.x86_64                                                                                              6/10
  Verifying  : epel-release-6-8.noarch                                                                                                             7/10
  Verifying  : python-crypto-2.0.1-22.el6.x86_64                                                                                                   8/10
  Verifying  : python-paramiko-1.7.5-2.1.el6.noarch                                                                                                9/10
  Verifying  : htop-1.0.1-2.el6.x86_64                                                                                                            10/10</p>

<p>Updated:
  epel-release.noarch 0:7-0.2               htop.x86_64 0:1.0.3-3.el7    python-crypto.x86_64 0:2.6.1-1.el7    python-paramiko.noarch 0:1.11.3-1.el7 <br/>
  python-simplejson.x86_64 0:3.3.3-1.el7</p>

<p>Complete!</code></pre></figure></p> <p>Let's reboot once more to make sure things are all cleanly started...</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># reboot</span></code></pre></figure></p> <p>Oh hey, it's a CentOS 7 box</p> <p><figure class=highlight><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@pingu ~<span class="o">]</span><span class="c"># cat /etc/redhat-release </span>
CentOS Linux release 7.0.1406 <span class="o">(</span>Core<span class="o">)</span> </code></pre></figure></p> <h2>Roundup</h2> <p>While it's too new to try out anywhere near production kit, for a set of tools that 'will need some patching to work properly' everything works pretty well.</p> <p>Hopefully with a few minor tweaks the packages will land on the normal mirrors and upgrading boxes will be bliss.</p> <p>Go play with <a href="http://seven.centos.org/">CentOS 7</a> and try out some of the neat features in the 3.10 kernel.</p> <p>As always, remember to <a href="http://stopdisablingselinux.com/">leave SELinux turned on</a>.</p> </div> </article> <article class=post> <h1 class=title><a href="/2013/01/what-is-anycast-and-why-would-i-use-it/">What's Anycast and why would I use it?</a></h1> <div class=meta> <span><img src="/assests/images/date.png" title=Date alt=Date />20 Jan 2013</span> <span><img src="/assests/images/comments.png" title=Content alt=Content /><a href="/2013/01/what-is-anycast-and-why-would-i-use-it/#disqus_thread">Comments</a></span> <ul class=categories> <li><a href='/tag/network'>Network</a></li><li><a href='/tag/dns'>DNS</a></li><li><a href='/tag/ipv4'>IPv4</a></li><li><a href='/tag/ipv6'>IPv6</a></li><li><a href='/tag/anycast'>Anycast</a></li></ul> </div> <div class=entry> <p>Recently I've heard some confusion as to what Anycast is, ranging from it being part of the IPv6 specification to multicast.</p> <p>While I'm not a network dude, hopefully this post will give you an overview of what Anycast is, how it's useful and what to watch out for.</p> <h2>Overview</h2> <p>Firstly to clear up some confusion, Anycast is not a protocol (TCP/UDP) or protocol version (IPv4/IPv6), but a type of addressing such as Unicast or Broadcast.</p> <p>As far as the 'client' is concerned, they are talking unicast (to a single node), but this may be routed to one of many nodes depending on the routing table.</p> <p>A quick example of this happening can be seen if you traceroute to an Anycast IP address from different locations in the world as seen below</p> <p><figure class=highlight><pre><code class="language-text" data-lang="text">traceroute to ian.ns.cloudflare.com (173.245.59.118), 30 hops max, 60 byte packets
 1  router1 (10.44.200.254)  15.334 ms  17.279 ms  19.183 ms
 2  host-92-23-160-1.as13285.net (92.23.160.1)  29.204 ms  32.556 ms  36.016 ms
 3  host-78-151-225-101.static.as13285.net (78.151.225.101)  38.386 ms  40.704 ms  42.598 ms
 4  host-78-151-225-84.static.as13285.net (78.151.225.84)  63.415 ms xe-11-2-0-bragg002.bir.as13285.net (78.151.225.72)  44.347 ms  46.697 ms
 5  xe-11-1-0-rt001.the.as13285.net (62.24.240.6)  49.117 ms xe-11-1-0-rt001.sov.as13285.net (62.24.240.14)  51.454 ms  54.374 ms
 6  host-78-144-1-61.as13285.net (78.144.1.61)  56.102 ms  48.605 ms  41.366 ms
 7  host-78-144-0-180.as13285.net (78.144.0.180)  42.400 ms host-78-144-0-116.as13285.net (78.144.0.116)  39.599 ms host-78-144-0-164.as13285.net (78.144.0.164)  37.310 ms
 8  195.66.225.179 (195.66.225.179)  38.239 ms  73.818 ms  72.494 ms
 9  ian.ns.cloudflare.com (173.245.59.118)  38.989 ms  37.828 ms  38.971 ms</code></pre></figure></p> <p><figure class=highlight><pre><code class="language-text" data-lang="text">traceroute to ian.ns.cloudflare.com (173.245.59.118), 30 hops max, 60 byte packets
 1  router1-dal.linode.com (67.18.7.161)  19.229 ms  19.291 ms  19.392 ms
 2  xe-2-0-0.car03.dllstx2.networklayer.com (67.18.7.89)  0.197 ms  0.220 ms  0.202 ms
 3  po101.dsr01.dllstx2.networklayer.com (70.87.254.73)  0.513 ms  0.537 ms  0.624 ms
 4  po21.dsr01.dllstx3.networklayer.com (70.87.255.65)  0.902 ms  0.983 ms  1.020 ms
 5  ae16.bbr01.eq01.dal03.networklayer.com (173.192.18.224)  16.145 ms  16.138 ms  16.112 ms
 6  141.101.74.253 (141.101.74.253)  0.602 ms  0.566 ms  0.549 ms
 7  ian.ns.cloudflare.com (173.245.59.118)  0.523 ms  0.670 ms  0.493 ms</code></pre></figure></p> <p>Note that the DNS (ian.ns.cloudflare.com) resolves to the same IP (173.245.59.118), but the traffic goes to different routers (141.101.74.253 vs 195.66.225.179).</p> <p>The 'magic' here happens at the routing layer, a router will have multiple 'paths' to the IP (173.245.59.118) and chooses the best one based on its metrics.</p> <p>A large (public) example of Anycast being used is the <a href="http://root-servers.org/">root nameservers</a> - combined there are something like 13 (v4) IP addresses serving NS entries, with ~350 servers behind those 13 IPs distributed throughout the world.</p> <h1>For those used to dealing with internal networks</h1> <p>Imagine you have 3 offices configured in a L2 triangle for redundancy:</p> <p><img src="/2013/01/what-is-anycast-and-why-would-i-use-it/e-s-w_triangle.jpeg" alt=""/></p> <p>Your gateway is England, Scotland and Wales need to access it if either of their links fail. You also have servers in each of the offices and want to access them as fast as possible.</p> <p>Keeping the links at layer 2 and blocking one (via something like STP) would give you gateway redundancy - if link A failed, link B would unblock and start forwarding traffic.</p> <p><img src="/2013/01/what-is-anycast-and-why-would-i-use-it/e-s-w_triangle-l2-failover.jpeg" alt=""/></p> <p>The problem here is you are having to go via Scotland to access Wales from England, when they have a direct link. You can't have both links up because you'd cause a loop and no traffic would pass.</p> <p>The solution is to make both links layer 3 and use a routing protocol to advertise the ranges over the top of them - there are reasons you'd want to use layer 2, or have one layer 2 and one layer 3, this is outside the scope of this example though.</p> <p>I'm not going to get into how to configure a routing protocol - there are a few to choose from, for this use case it doesn't hugely matter. Let's assume both links are the same speed and are direct (1 hop away).</p> <p>The topology looks something like</p> <p><img src="/2013/01/what-is-anycast-and-why-would-i-use-it/e-s-w_triangle-l3-routes.jpeg" alt=""/></p> <p>This means if any of the offices want to talk to another office, they are only 1 hop away and don't have to go though a middle man gateway - but if the direct link fails, they can be re-routed the long (2 hops) way around.</p> <p><img src="/2013/01/what-is-anycast-and-why-would-i-use-it/e-s-w_triangle-l3-routes-failure.jpeg" alt=""/></p> <p>In summary using routing between the 3 offices allows for transparent fail over and best-performance access. In a more complicated topology this is very useful.</p> <p>Essentially, this is also how 'Anycast' works - the main difference being is we're dealing with multiple nodes, rather than just re-advertising a single node (route). The routing doesn't care either way - it will choose the 'best' path based on what it knows about.</p> <h2>Why is this useful?</h2> <p>Anycast gives you a number of benefits such as</p> <ul> <li>Higher reliability/availability</li> <li>Higher performance</li> <li>Localisation/migration of DoS/DDoS attacks</li> <li>Client agnostic</li> </ul> <h2>Why doesn't everyone use it?</h2> <p>There are some drawbacks to using Anycast addressing</p> <ul> <li>Can be complex to deploy - requires an AS, addressing/routing management, more routes being advertised</li> <li>Can be expensive - IP space, network infrastructure, training</li> <li>Harder to troubleshoot</li> <li>Harder to monitor</li> </ul> <h2>How would I use it?</h2> <p>One of the most common use in for DNS services, however any stateless protocol can take advantage of Anycast - it is possible to use stateful protocols, however you need a much higher level of control and risk 'breaking' connections across 2 nodes.</p> <p>Imagine you where serving users out of Europe, US and Asia-Pacific.</p> <p>A common thing to do would be create 3 NS entries pointing to servers in each location</p> <p><figure class=highlight><pre><code class="language-text" data-lang="text">myawesomedns.something. 360 IN  SOA ns1.myawesomedns.something. root.myawesomedns.something. (1303702991 14400 14400 1209600 86400)</p>

<p>myawesomedns.something. 360 IN  NS  ns1.myawesomedns.something.
myawesomedns.something. 360 IN  NS  ns2.myawesomedns.something.
myawesomedns.something. 360 IN  NS  ns3.myawesomedns.something.</p>

<p>; EU
ns1 360 IN  A   10.0.0.1</p>

<p>; APAC
ns2 360 IN  A   192.168.0.1</p>

<p>; US
ns3 360 IN  A   172.16.0.1</code></pre></figure></p> <p>These NS records would then be "glued" on the root nameservers, so the first resolver can find the NS servers IP address.</p> <p>Now there are 2 problems with this, if you loose a server the resolver (client) will be slow to fail over (probably timing out a few requests) and a user in the US might end up going to the server in APAC rather than the 'local' one to them.</p> <p>Anycast helps to solve both these issues.</p> <p>If a server goes down you can withdraw the route and (as long as you're not flapping routes) your peers should pick it up in a few minutes.</p> <p>In the case of a user making a request to the Anycast IP, the request will be routed to the 'nearest' node - in normal operation this would be the 'local' one, if that had failed it would automatically (after the route withdrawal) go to the next 'nearest'.</p> <p>Now I'm quoting 'nearest' and 'local' and these are determined by your routing protocol, normally based on metrics such as weight, hops or speed, rather than physical location.</p> <p>The routing before we start using Anycast</p> <p><img src="/2013/01/what-is-anycast-and-why-would-i-use-it/dns-pre-anycast-routing.jpeg" alt=""/></p> <p>Requests to ns{1..3} (192.168.0.1, 127.16.0.1, 10.0.0.1) before we start using Anycast</p> <p><img src="/2013/01/what-is-anycast-and-why-would-i-use-it/dns-pre-anycast-requests.jpeg" alt=""/></p> <p>So lets start using Anycast, we're going to keep the original IPs as 'maintenance' IPs - ones we know only go to that single host and create a new block.</p> <p><figure class=highlight><pre><code class="language-text" data-lang="text">myawesomedns.something. 360 IN  SOA ns1.myawesomedns.something. root.myawesomedns.something. (1303702991 14400 14400 1209600 86400)</p>

<p>myawesomedns.something. 360 IN  NS  ns1.myawesomedns.something.
myawesomedns.something. 360 IN  NS  ns2.myawesomedns.something.
myawesomedns.something. 360 IN  NS  ns3.myawesomedns.something.</p>

<p>; EU
srv-ns1 360 IN  A   10.0.0.1</p>

<p>; APAC
srv-ns2 360 IN  A   192.168.0.1</p>

<p>; US
srv-ns3 360 IN  A   172.16.0.1</p>

<p>; Anycast
ns1 360 IN A 10.1.0.1
ns2 360 IN A 10.1.0.2
ns3 360 IN A 10.1.0.3</code></pre></figure></p> <p>10.1.0.1, 10.1.0.2 &amp; 10.1.0.3 now need to be advertised from the EU, APAC and US routers as /32 blocks - with no summary route for 10.1.0.0 0.0.0.255. 10.1.0.1, 10.1.0.2 &amp; 10.1.0.3 also need to be brought up on loopback interfaces on the server and the DNS server configured to bind to them.</p> <p>Once this propagates out routing will take care of sending your traffic to the right place, in the event of an outage or maintenance just withdraw the routes so they are no longer advertised and traffic will be re-routed.</p> <p>This is slightly oversimplified as there is a certain level of tuning needed to stop flapping, which can cause your updates to be delayed (due to dampening timers etc).</p> <p>I won't go into the BGP configuration in this post as it's a little lengthy to explain/draw how routing tables look, essentially you configure your neighbours and send them /32 routes - <a href="http://www.cisco.com/en/US/tech/tk365/technologies_configuration_example09186a008009456d.shtml">cisco</a> have a nice example for configuring BGP on IOS. Be careful (use filters) when dealing with BGP/EGP protocols as you can do really weird things ;)</p> <p>The routing after we start using 'Anycast' IPs</p> <p><img src="/2013/01/what-is-anycast-and-why-would-i-use-it/dns-post-anycast-routing.jpeg" alt=""/></p> <p>Requests to ns{1..3} (10.1.0.{1..3}) after we start using 'Anycast' IPs</p> <p><img src="/2013/01/what-is-anycast-and-why-would-i-use-it/dns-post-anycast-requests.jpeg" alt=""/></p> <p>In the case of the EU site failing the routes would withdraw and requests would be re-routed</p> <p><img src="/2013/01/what-is-anycast-and-why-would-i-use-it/dns-post-anycast-failure.jpeg" alt=""/></p> <p>In the case of the EU and the US sites failing, requests would be re-routed in the same manner</p> <p><img src="/2013/01/what-is-anycast-and-why-would-i-use-it/dns-post-anycast-failure2.jpeg" alt=""/></p> <p>All this happens at layer 3 - in the DNS service scenario we would probably use GeoIP logic at layer 7 to localise the response and then serve the request.</p> </div> </article> <article class=post> <h1 class=title><a href="/2012/09/slow-ssh-to-new-centos-servers/">Slow SSH to new CentOS servers</a></h1> <div class=meta> <span><img src="/assests/images/date.png" title=Date alt=Date />08 Sep 2012</span> <span><img src="/assests/images/comments.png" title=Content alt=Content /><a href="/2012/09/slow-ssh-to-new-centos-servers/#disqus_thread">Comments</a></span> <ul class=categories> <li><a href='/tag/software'>Software</a></li><li><a href='/tag/ssh'>SSH</a></li><li><a href='/tag/centos'>CentOS</a></li><li><a href='/tag/dns'>DNS</a></li><li><a href='/tag/ipv4'>IPv4</a></li><li><a href='/tag/ipv6'>IPv6</a></li><li><a href='/tag/linux'>Linux</a></li></ul> </div> <div class=entry> <p>Recently when installing new servers I 'randomly' had an issue where SSH connections would lag out for 20-30 seconds on login then function fine once authenticated.</p> <p>I noticed this issue on CentOS 5/6 servers, however it probably applies to anything running glibc 2.10+.</p> <p>Now while there are a few reasons SSH might be doing this (most of which can be seen using verbose flags), it wasn't the usual suspects (GSSAPI etc).</p> <p>The interesting part was, this wasn't happening on all servers (they are standard config wise thanks to puppet).</p> <p>It turns out the UseDNS setting was failing, very slowly. Now a simple way to quickly solve the issue is to set <code>UseDNS no</code> in your sshd_config file.</p> <p>This might be acceptable, depending on how much you have access restricted however there is an alternative.</p> <p>It turns out there was a change in glibc that can be seen on the changelog <a href="http://sourceware.org/ml/libc-alpha/2009-10/msg00063.html">here</a>.</p> <p>Under some circumstances (especially when firewalls are involved) DNS resolution will fail and glibc should fallback, close the socket and start again. It would seem this takes rather a long while when trying to SSH!</p> <p>Thankfully there is a (<a href="https://bugzilla.kernel.org/show_bug.cgi?id=38542">recently</a> documented) option that you can add to your resolv.conf file <code>single-request-reopen</code>. This forces glibc to enter fallback mode straight away and kills the delay.</p> <p>An example of the 'patched' /etc/resolv.conf file</p> <p><figure class=highlight><pre><code class="language-text" data-lang="text"># This file is managed via Puppet</p>

<h1>Servers</h1>

<p>nameserver 8.8.8.8
nameserver 8.8.4.4
nameserver 208.67.222.222
nameserver 208.67.220.220</p>

<h1>Options</h1>

<p>options single-request-reopen</code></pre></figure></p> <p>Now you might want to dig into your network stack a little more and make sure you can handle IPv6/dual stack properly but for now, problem solved!</p> </div> </article> <article class=post> <h1 class=title><a href="/2012/09/kvirc-update-breaks-irssi-proxy/">KVIrc update breaks Irssi Proxy</a></h1> <div class=meta> <span><img src="/assests/images/date.png" title=Date alt=Date />04 Sep 2012</span> <span><img src="/assests/images/comments.png" title=Content alt=Content /><a href="/2012/09/kvirc-update-breaks-irssi-proxy/#disqus_thread">Comments</a></span> <ul class=categories> <li><a href='/tag/how-to'>How-to</a></li><li><a href='/tag/software'>Software</a></li><li><a href='/tag/irc'>IRC</a></li><li><a href='/tag/irssi'>Irssi</a></li><li><a href='/tag/kvirc'>KVIrc</a></li></ul> </div> <div class=entry> <p>I recently updated KVIrc on OS X from 3.2.0 to 4.2.0. The update appeared to complete successfully, however on trying to connect to my Irssi Proxy server nothing appeared to happen.</p> <p>The output from the server console was something like below</p> <p><figure class=highlight><pre><code class="language-text" data-lang="text">This is the first connection in this IRC context: using the global server
setting
Attempting connection to myirssiproxy.local (RawrIRC) on port 8000
Looking up the server hostname (myirssiproxy.local)...
Server hostname resolved to 10.44.1.1
Contacting IRC server myirssiproxy.local (10.44.1.1) on port 8000
Connection established [myirssiproxy.local (10.44.1.1:8000)]
Local host address is 10.44.1.2</code></pre></figure></p> <p>It turns out that in 4.2.0 the servers automatically had 'Switch to SSL/TLS by using the STARTTLS extension' enabled.</p> <p>Unfortunately Irssi Proxy doesn't like STARTTLS, so while the logs show successful connections no data is transferred over the socket.</p> <p>The simple solution to get things back up and running properly is to disable the option under each server.</p> <p>To do this browse to 'Configure servers' under Settings, double click on the server under the network, tab over to Advanced and disable 'Switch to SSL/TLS by using the STARTTLS extension'.</p> <p>If you have a large number of servers you can also directly edit the ini file under ~/.config/KVIrc/config/serverdb.kvc. In this file each network is a section and each server is numbered.</p> <p>To disabled STARTTLS for the first server in network A, your config should look something like the below</p> <p><figure class=highlight><pre><code class="language-ini" data-lang="ini"><span class="k">[A]</span>
<span class="na">0_EnabledSTARTTLS</span><span class="o">=</span><span class="s">false</span></code></pre></figure></p> <p>This will usually have a number of other items, a full example is below</p> <p><figure class=highlight><pre><code class="language-ini" data-lang="ini"><span class="k">[FreeNode]</span>
<span class="na">0_Port</span><span class="o">=</span><span class="s">8000</span>
<span class="na">0_Hostname</span><span class="o">=</span><span class="s">myirssiproxy.local</span>
<span class="na">0_Ip</span><span class="o">=</span><span class="s">10.44.1.1</span>
<span class="na">0_Nick</span><span class="o">=</span><span class="s">MyNick</span>
<span class="na">NServers</span><span class="o">=</span><span class="s">1</span>
<span class="na">RealName</span><span class="o">=</span><span class="s">MyName</span>
<span class="na">0_Pass</span><span class="o">=</span><span class="s">Mypass</span>
<span class="na">0_AutoConnect</span><span class="o">=</span><span class="s">true</span>
<span class="na">0_EnabledSTARTTLS</span><span class="o">=</span><span class="s">false</span>
<span class="na">NickName</span><span class="o">=</span><span class="s">MyNick</span>
<span class="na">0_Id</span><span class="o">=</span><span class="s">Server1</span>
<span class="na">0_EnabledCAP</span><span class="o">=</span><span class="s">false</span>
<span class="na">0_RealName</span><span class="o">=</span><span class="s">MyName</span>
<span class="na">0_User</span><span class="o">=</span><span class="s">MyUser</span>
<span class="na">UserName</span><span class="o">=</span><span class="s">Damian</span></code></pre></figure></p> <p>This also makes it quite easy to generally manage servers in KVIrc, outside of wide scale settings changes.</p> </div> </article> <article class=post> <h1 class=title><a href="/2012/08/running-a-wsgi-app-via-gunicorn-from-python/">Running a WSGI app via Gunicorn from Python</a></h1> <div class=meta> <span><img src="/assests/images/date.png" title=Date alt=Date />20 Aug 2012</span> <span><img src="/assests/images/comments.png" title=Content alt=Content /><a href="/2012/08/running-a-wsgi-app-via-gunicorn-from-python/#disqus_thread">Comments</a></span> <ul class=categories> <li><a href='/tag/how-to'>How-to</a></li><li><a href='/tag/software'>Software</a></li><li><a href='/tag/python'>Python</a></li><li><a href='/tag/wsgi'>WSGI</a></li><li><a href='/tag/gunicorn'>Gunicorn</a></li></ul> </div> <div class=entry> <p>Anyone who's familiar with Gunicorn will know just how simple it is to get up and running; <code>gunicorn myapp.wsgi</code>.</p> <p>For a little project I'm working on I wanted to take this up a level and run Gunicorn from a Python script, passing in any options as required and not relying on sys.argv.</p> <p>Because of the way most the Gunicorn application classes are written they expect to be run from the console_scripts setup and have rather close integration.</p> <p>Unfortunately this made getting to the point of running <code>run.py</code> and having Gunicorn start, rather harder than it needed to be.</p> <p>For the purposes of this post my WSGI application is the example Flask app;</p> <p><figure class=highlight><pre><code class="language-python" data-lang="python"><span class="c"># myapp.wsgi</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span></p>

<p><span class="n">application</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n"><strong>name</strong></span><span class="p">)</span></p>

<p><span class="nd">@application.route</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;Hello World!&quot;</span></p>

<p><span class="k">if</span> <span class="n"><strong>name</strong></span> <span class="o">==</span> <span class="s">&quot;<strong>main</strong>&quot;</span><span class="p">:</span>
    <span class="n">application</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></code></pre></figure></p> <p>Now, to get this running under Gunicorn we need to create a custom application</p> <p><figure class=highlight><pre><code class="language-python" data-lang="python"><span class="c"># myapp.mycustomapplication</span>
<span class="kn">from</span> <span class="nn">gunicorn.app.base</span> <span class="kn">import</span> <span class="n">Application</span>
<span class="kn">from</span> <span class="nn">gunicorn</span> <span class="kn">import</span> <span class="n">util</span></p>

<p><span class="k">class</span> <span class="nc">MyCustomApplication</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Custom Gunicorn Application</span>
<span class="sd">    &#39;&#39;&#39;</span></p>

<pre><code>&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{}):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39;__init__ method&lt;/span&gt;
</code></pre> <p><span class=sd> Load the base config and assign some core attributes.</span> <span class=sd> &#39;&#39;&#39;</span> <span class=bp>self</span><span class=o>.</span><span class=n>usage</span> <span class=o>=</span> <span class=bp>None</span> <span class=bp>self</span><span class=o>.</span><span class=n>callable</span> <span class=o>=</span> <span class=bp>None</span> <span class=bp>self</span><span class=o>.</span><span class=n>options</span> <span class=o>=</span> <span class=n>options</span> <span class=bp>self</span><span class=o>.</span><span class=n>do_load_config</span><span class=p>()</span></p> <pre><code>&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;init&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39;init method&lt;/span&gt;
</code></pre> <p><span class=sd> Takes our custom options from self.options and creates a config</span> <span class=sd> dict which specifies custom settings.</span> <span class=sd> &#39;&#39;&#39;</span> <span class=n>cfg</span> <span class=o>=</span> <span class=p>{}</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>options</span><span class=o>.</span><span class=n>items</span><span class=p>():</span> <span class=k>if</span> <span class=n>k</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>cfg</span><span class=o>.</span><span class=n>settings</span> <span class=ow>and</span> <span class=n>v</span> <span class=ow>is</span> <span class=ow>not</span> <span class=bp>None</span><span class=p>:</span> <span class=n>cfg</span><span class=p>[</span><span class=n>k</span><span class=o>.</span><span class=n>lower</span><span class=p>()]</span> <span class=o>=</span> <span class=n>v</span> <span class=k>return</span> <span class=n>cfg</span></p> <pre><code>&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39;load method&lt;/span&gt;
</code></pre> <p><span class=sd> Imports our application and returns it to be run.</span> <span class=sd> &#39;&#39;&#39;</span> <br/> <span class=k>return</span> <span class=n>util</span><span class=o>.</span><span class=n>import_app</span><span class=p>(</span><span class=s>&quot;myapp.wsgi&quot;</span><span class=p>)</span></code></pre></figure></p> <p>As far as I can tell the minimum methods you can define is 3;</p> <ol> <li><code>__init__</code> - This sets up our base attributes</li> <li><p><code>init</code> - This is called to load option settings, we use self.options to set the cfg items.</p></li> <li><p><code>load</code> - This loads the application so when <code>wsgi()</code> is called the app runs!</p></li> </ol> <p>To run the application we just need to initialize the MyCustomApplication class, passing any options as required.</p> <p><figure class=highlight><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>
<span class="c"># myapp.run</span></p>

<p><span class="kn">from</span> <span class="nn">myapp.mycustomapplication</span> <span class="kn">import</span> <span class="n">MyCustomApplication</span></p>

<p><span class="k">if</span> <span class="n"><strong>name</strong></span> <span class="o">==</span> <span class="s">&quot;<strong>main</strong>&quot;</span><span class="p">:</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;bind&#39;</span><span class="p">:</span> <span class="s">&#39;localhost:8080&#39;</span><span class="p">,</span>
    <span class="p">}</span></p>

<pre><code>&lt;span class="n"&gt;MyCustomApplication&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;options&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
</code></pre> <p>In practice you'd probably load the options from a config file in your program.</p> <p>Hopefully this should help you getting Gunicorn running smoothly in a more integrated manner :)</p> </div> </article> <nav id=page_nav> <a href="/2/" class=next>Next Page &raquo;</a> </nav> </div> <footer class=footer> <div class=container> <p class=text-muted>Copyright 2009-2015 <a href="http://damianzaremba.co.uk">Damian Zaremba</a></p> <ul id=ads> <li>Need error logging? Try <a href="https://getsentry.com/signup/r_D0ZW/">Sentry</a></li> <li>Need cloud instances? Jump on <a href="http://www.bigv.io">BigV</a></li> <li>Want my website? <a href="https://github.com/DamianZaremba/damianzaremba.co.uk/">Source</a></li> </ul> </div> </footer> <script src="/assests/js/jquery.min.js?v1"></script> <script src="/assests/js/bootstrap.min.js?v1"></script> <script type="text/javascript">var _gaq=_gaq||[];_gaq.push(["_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"]);_gaq.push(["_setAccount","UA-11817192-1"]);_gaq.push(["_setDomainName","damianzaremba.co.uk"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src="//stats.g.doubleclick.net/dc.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="//damianzaremba.disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script> <!--[if lt IE 9]><script src="/assests/js/html5shiv.min.js?v1"></script> <script src="/assests/js/respond.min.js?v1"></script><![endif]--> </body> </html>